<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹•ç”»5: GASã‹ã‚‰ChatGPTã‚’å‹•ã‹ã™ï¼æ³¨æ–‡æ›¸ã‹ã‚‰ä¼šç¤¾åã¨æ•°é‡ã‚’æŠœãå‡ºã™å®Ÿè·µã‚³ãƒ¼ãƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .section h2 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .section h3 {
            color: #34495e;
            font-size: 1.5em;
            margin: 20px 0 15px 0;
        }
        
        .integration-flow {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            padding: 30px;
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            border-radius: 15px;
        }
        
        .flow-step {
            text-align: center;
            flex: 1;
        }
        
        .flow-arrow {
            font-size: 2em;
            color: #2c3e50;
            margin: 0 20px;
        }
        
        .code-section {
            background: #2d3436;
            color: #ddd;
            padding: 25px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            overflow-x: auto;
            border-left: 4px solid #74b9ff;
        }
        
        .code-section h4 {
            color: #74b9ff;
            margin-bottom: 15px;
            font-family: 'Segoe UI', sans-serif;
        }
        
        .api-config {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .config-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 10px;
        }
        
        .result-showcase {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        .input-example, .output-example {
            padding: 25px;
            border-radius: 10px;
        }
        
        .input-example {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
        }
        
        .output-example {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
        }
        
        .validation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .validation-card {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }
        
        .highlight {
            background: linear-gradient(120deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .success-box {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .warning-box {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .performance-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        ul {
            margin: 20px 0;
            padding-left: 30px;
        }
        
        li {
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .result-showcase {
                grid-template-columns: 1fr;
            }
            
            .integration-flow {
                flex-direction: column;
            }
            
            .flow-arrow {
                transform: rotate(90deg);
                margin: 20px 0;
            }
            
            .performance-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ¤– å‹•ç”»5: GASã‹ã‚‰ChatGPTã‚’å‹•ã‹ã™ï¼</h1>
            <p>æ³¨æ–‡æ›¸ã‹ã‚‰ä¼šç¤¾åã¨æ•°é‡ã‚’æŠœãå‡ºã™å®Ÿè·µã‚³ãƒ¼ãƒ‰</p>
        </header>

        <section class="section">
            <h2>ğŸ¯ å­¦ç¿’ç›®æ¨™</h2>
            <ul>
                <li>OpenAI APIã‚­ãƒ¼ã®å–å¾—ã¨å®‰å…¨ãªç®¡ç†æ–¹æ³•ã‚’ç¿’å¾—ã™ã‚‹</li>
                <li>Google Apps Scriptã‹ã‚‰ChatGPT APIã‚’å‘¼ã³å‡ºã™å®Ÿè£…ã‚’å®Œæˆã™ã‚‹</li>
                <li>OCRâ†’AIæŠ½å‡ºã®ä¸€è²«ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹</li>
                <li>æŠ½å‡ºãƒ‡ãƒ¼ã‚¿ã®å“è³ªæ¤œè¨¼ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã™ã‚‹</li>
                <li>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã¨ã‚³ã‚¹ãƒˆç®¡ç†ã®æ‰‹æ³•ã‚’ç†è§£ã™ã‚‹</li>
            </ul>
        </section>

        <section class="section">
            <h2>ğŸ”— å‹•ç”»1-5çµ±åˆãƒ•ãƒ­ãƒ¼ã®å…¨ä½“åƒ</h2>
            <div class="integration-flow">
                <div class="flow-step">
                    <strong>ğŸ“„ å‹•ç”»1-2</strong><br>
                    å•é¡Œè¨­å®š+<br>APIåŸºç›¤æ§‹ç¯‰
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">
                    <strong>ğŸ‘ï¸ å‹•ç”»3</strong><br>
                    Vision API<br>OCRå®Ÿè£…
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">
                    <strong>ğŸ¯ å‹•ç”»4</strong><br>
                    ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ<br>8ã‚µãƒ³ãƒ—ãƒ«æ¤œè¨¼
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">
                    <strong>ğŸ¤– å‹•ç”»5</strong><br>
                    ChatGPTçµ±åˆ<br>å®Œå…¨è‡ªå‹•åŒ–
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">
                    <strong>ğŸ’¾ æ¬¡å›ä»¥é™</strong><br>
                    ãƒ‡ãƒ¼ã‚¿è“„ç©<br>é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
                </div>
            </div>

            <h3>ğŸ”¥ å‹•ç”»5ã®æ ¸å¿ƒï¼šçµ±åˆå‡¦ç†ã®å®Ÿè£…</h3>
            <div class="success-box">
                <p>ã“ã‚Œã¾ã§ã®4ã¤ã®å‹•ç”»ã™ã¹ã¦ãŒä»Šå›ä¸€ã¤ã«ã¤ãªãŒã‚Šã¾ã™ã€‚å‹•ç”»3ã®OCRå‡¦ç†ã¨å‹•ç”»4ã®8ã¤ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆã§æ¤œè¨¼æ¸ˆã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’çµ±åˆã—ã€<span class="highlight">å®Œå…¨è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ </span>ã‚’å®Œæˆã•ã›ã¾ã™ã€‚</p>
            </div>
        </section>

        <section class="section">
            <h2>âš™ï¸ OpenAI APIè¨­å®š</h2>
            
            <div class="api-config">
                <div class="config-card">
                    <h3>ğŸ”‘ APIã‚­ãƒ¼å–å¾—</h3>
                    <ol>
                        <li>OpenAIå…¬å¼ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹</li>
                        <li>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»ãƒ­ã‚°ã‚¤ãƒ³</li>
                        <li>API Keysãƒšãƒ¼ã‚¸ã§ã‚­ãƒ¼ç”Ÿæˆ</li>
                        <li>å®‰å…¨ãªå ´æ‰€ã«ä¿å­˜</li>
                    </ol>
                </div>
                <div class="config-card">
                    <h3>ğŸ’° æ–™é‡‘è¨­å®š</h3>
                    <ul>
                        <li><strong>GPT-4o-mini:</strong> å®‰ä¾¡ã§é«˜æ€§èƒ½</li>
                        <li><strong>å…¥åŠ›:</strong> $0.15/1Mãƒˆãƒ¼ã‚¯ãƒ³</li>
                        <li><strong>å‡ºåŠ›:</strong> $0.60/1Mãƒˆãƒ¼ã‚¯ãƒ³</li>
                        <li><strong>æœˆé¡ç›®å®‰:</strong> ç´„1,000å††</li>
                    </ul>
                </div>
                <div class="config-card">
                    <h3>ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</h3>
                    <ul>
                        <li>Script Propertiesã§ç®¡ç†</li>
                        <li>ã‚³ãƒ¼ãƒ‰ã«ç›´æ¥è¨˜è¼‰ç¦æ­¢</li>
                        <li>å®šæœŸçš„ãªã‚­ãƒ¼æ›´æ–°</li>
                        <li>ä½¿ç”¨é‡ç›£è¦–ã®è¨­å®š</li>
                    </ul>
                </div>
            </div>

            <div class="code-section">
                <h4>APIã‚­ãƒ¼ã®å®‰å…¨ãªè¨­å®šæ–¹æ³•</h4>
                <pre>function setOpenAIAPIKey() {
  const apiKey = 'your_actual_api_key_here';
  PropertiesService.getScriptProperties()
    .setProperty('OPENAI_API_KEY', apiKey);
  console.log('OpenAI API ã‚­ãƒ¼ã‚’è¨­å®šã—ã¾ã—ãŸ');
}</pre>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ’» å‹•ç”»1-5çµ±åˆ: ChatGPT APIå‘¼ã³å‡ºã—å®Ÿè£…</h2>
            
            <div class="success-box">
                <h3>ğŸ¯ çµ±åˆã®ãƒã‚¤ãƒ³ãƒˆ</h3>
                <ul>
                    <li><strong>å‹•ç”»3ã®é–¢æ•°:</strong> performOCR(), convertPDFToImageAndOCR()</li>
                    <li><strong>å‹•ç”»4ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:</strong> createOrderExtractionPrompt() + 8ã‚µãƒ³ãƒ—ãƒ«æ¤œè¨¼æ¸ˆã¿</li>
                    <li><strong>å‹•ç”»5ã®æ–°æ©Ÿèƒ½:</strong> çµ±åˆå®Ÿè¡Œ + å“è³ªæ¤œè¨¼ + ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</li>
                </ul>
            </div>

            <div class="code-section">
                <h4>ãƒ¡ã‚¤ãƒ³çµ±åˆå‡¦ç†é–¢æ•°ï¼ˆå‹•ç”»5ã®æ ¸å¿ƒï¼‰</h4>
                <pre>function runVideo5MainProcess() {
  try {
    console.log('=== å‹•ç”»1-5çµ±åˆå‡¦ç†é–‹å§‹ ===');
    
    // å‹•ç”»1-2ã§æ§‹ç¯‰ã—ãŸåŸºç›¤ã®ä¸Šã§ã€å‹•ç”»3-5ã‚’çµ±åˆå®Ÿè¡Œ
    const latestPDF = findLatestPDFInAIFolder();
    if (!latestPDF) {
      console.log('å‡¦ç†å¯¾è±¡ã®PDFãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      return null;
    }
    
    // å‹•ç”»3: Vision API OCRå‡¦ç†
    const ocrText = convertPDFToImageAndOCR(latestPDF);
    if (!ocrText) {
      console.log('OCRå‡¦ç†ãŒå¤±æ•—ã—ã¾ã—ãŸ');
      return null;
    }
    
    // å‹•ç”»4+5: æ¤œè¨¼æ¸ˆã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ChatGPT APIå‘¼ã³å‡ºã—
    const extractedInfo = extractOrderInfo(ocrText);
    if (extractedInfo.extraction_failed) {
      console.log('æƒ…å ±æŠ½å‡ºãŒå¤±æ•—ã—ã¾ã—ãŸ');
      return null;
    }
    
    // å‹•ç”»5: å“è³ªæ¤œè¨¼
    const validation = validateExtractedData(extractedInfo);
    
    console.log('=== çµ±åˆå‡¦ç†å®Œäº† ===');
    console.log('æŠ½å‡ºçµæœ:', extractedInfo);
    console.log('å“è³ªã‚¹ã‚³ã‚¢:', validation.score);
    
    return {
      success: true,
      extracted_info: extractedInfo,
      validation: validation,
      ocr_text: ocrText
    };
    
  } catch (error) {
    console.error('çµ±åˆå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
    return { success: false, error: error.message };
  }
}</pre>
            </div>

            <div class="code-section">
                <h4>ChatGPT APIå‘¼ã³å‡ºã—ï¼ˆå‹•ç”»4ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä½¿ç”¨ï¼‰</h4>
                <pre>function extractOrderInfo(ocrText) {
  try {
    console.log('ChatGPT ã«ã‚ˆã‚‹æƒ…å ±æŠ½å‡ºé–‹å§‹');
    
    // APIã‚­ãƒ¼ã®å–å¾—
    const apiKey = PropertiesService.getScriptProperties()
      .getProperty('OPENAI_API_KEY');
    
    if (!apiKey) {
      throw new Error('OpenAI API ã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
    }
    
    // å‹•ç”»4ã§è¨­è¨ˆãƒ»æ¤œè¨¼ã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨
    const prompt = createOrderExtractionPrompt(ocrText);
    
    // ChatGPT APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è¨­å®š
    const payload = {
      model: "gpt-4o-mini",
      messages: [{ role: "user", content: prompt }],
      max_tokens: 1000,
      temperature: 0.1  // å®‰å®šã—ãŸçµæœã®ãŸã‚ä½æ¸©åº¦è¨­å®š
    };
    
    // APIå‘¼ã³å‡ºã—
    const response = UrlFetchApp.fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Content-Type': 'application/json'
      },
      payload: JSON.stringify(payload)
    });
    
    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æ
    const result = JSON.parse(response.getContentText());
    const extractedText = result.choices[0].message.content;
    const extractedInfo = JSON.parse(extractedText);
    
    console.log('æƒ…å ±æŠ½å‡ºå®Œäº†:', extractedInfo);
    return extractedInfo;
    
  } catch (error) {
    console.error('ChatGPT API ã‚¨ãƒ©ãƒ¼:', error);
    return {
      error: error.message,
      extraction_failed: true
    };
  }
}</pre>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ“Š å‡¦ç†çµæœã®ä¾‹ç¤º</h2>
            <div class="result-showcase">
                <div class="input-example">
                    <h3>ğŸ“¥ å…¥åŠ›ï¼šOCRãƒ†ã‚­ã‚¹ãƒˆ</h3>
                    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 5px; font-family: monospace;">
æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«å•†äº‹<br>
æ‹…å½“è€…: ç”°ä¸­ å¤ªéƒ<br>
TEL: 03-1234-5678<br>
<br>
æ³¨æ–‡æ—¥: 2025å¹´7æœˆ10æ—¥<br>
ç´æœŸ: 2025å¹´7æœˆ20æ—¥<br>
<br>
å•†å“æ˜ç´°:<br>
1. ã‚ªãƒ•ã‚£ã‚¹ãƒã‚§ã‚¢ OC-001 5è„š @15,000å††<br>
2. ãƒ‡ã‚¹ã‚¯ DS-002 3å° @25,000å††<br>
<br>
åˆè¨ˆé‡‘é¡: 150,000å††ï¼ˆç¨è¾¼ï¼‰
                    </div>
                </div>
                <div class="output-example">
                    <h3>ğŸ“¤ å‡ºåŠ›ï¼šæ§‹é€ åŒ–JSON</h3>
                    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 5px; font-family: monospace; font-size: 0.9em;">
{<br>
&nbsp;&nbsp;"company": "æ ªå¼ä¼šç¤¾ã‚µãƒ³ãƒ—ãƒ«å•†äº‹",<br>
&nbsp;&nbsp;"contact_name": "ç”°ä¸­ å¤ªéƒ",<br>
&nbsp;&nbsp;"contact_phone": "03-1234-5678",<br>
&nbsp;&nbsp;"items": [<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"name": "ã‚ªãƒ•ã‚£ã‚¹ãƒã‚§ã‚¢",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"code": "OC-001",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"quantity": 5,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"unit_price": 15000<br>
&nbsp;&nbsp;&nbsp;&nbsp;},<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"name": "ãƒ‡ã‚¹ã‚¯",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"code": "DS-002",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"quantity": 3,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"unit_price": 25000<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;],<br>
&nbsp;&nbsp;"total_amount": 150000,<br>
&nbsp;&nbsp;"delivery_date": "2025-07-20"<br>
}
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>âœ… ãƒ‡ãƒ¼ã‚¿å“è³ªæ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ </h2>
            
            <div class="validation-grid">
                <div class="validation-card">
                    <h3>ğŸ” å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯</h3>
                    <ul>
                        <li>ä¼šç¤¾åã®å­˜åœ¨ç¢ºèª</li>
                        <li>åˆè¨ˆé‡‘é¡ã®æ•°å€¤æ€§</li>
                        <li>å•†å“æƒ…å ±ã®å®Œæ•´æ€§</li>
                    </ul>
                </div>
                <div class="validation-card">
                    <h3>âš–ï¸ æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯</h3>
                    <ul>
                        <li>å°è¨ˆã®åˆè¨ˆ = ç·é¡</li>
                        <li>æ•°é‡ Ã— å˜ä¾¡ = å°è¨ˆ</li>
                        <li>æ—¥ä»˜ã®å¦¥å½“æ€§</li>
                    </ul>
                </div>
                <div class="validation-card">
                    <h3>ğŸ“Š å“è³ªã‚¹ã‚³ã‚¢</h3>
                    <ul>
                        <li>0-100ç‚¹ã§è©•ä¾¡</li>
                        <li>ä¿¡é ¼åº¦ãƒ¬ãƒ™ãƒ«ç®—å‡º</li>
                        <li>æ”¹å–„ææ¡ˆã®ç”Ÿæˆ</li>
                    </ul>
                </div>
            </div>

            <div class="code-section">
                <h4>ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼é–¢æ•°</h4>
                <pre>function validateExtractedData(data) {
  const issues = [];
  let score = 100;
  
  // å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯
  if (!data.company) {
    issues.push('ä¼šç¤¾åãŒæŠ½å‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“');
    score -= 30;
  }
  
  if (!data.total_amount || isNaN(data.total_amount)) {
    issues.push('åˆè¨ˆé‡‘é¡ãŒæ­£ã—ãæŠ½å‡ºã•ã‚Œã¦ã„ã¾ã›ã‚“');
    score -= 25;
  }
  
  // ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
  if (data.items && data.items.length > 0 && data.total_amount) {
    const calculatedTotal = data.items.reduce((sum, item) => {
      return sum + (item.subtotal || (item.quantity * item.unit_price) || 0);
    }, 0);
    
    const difference = Math.abs(calculatedTotal - data.total_amount);
    const tolerance = data.total_amount * 0.05; // 5%ã®èª¤å·®è¨±å®¹
    
    if (difference > tolerance) {
      issues.push(`é‡‘é¡è¨ˆç®—ã«ä¸æ•´åˆãŒã‚ã‚Šã¾ã™`);
      score -= 15;
    }
  }
  
  return {
    score: Math.max(score, 0),
    issues: issues,
    is_valid: issues.length === 0,
    confidence_level: score >= 80 ? 'high' : score >= 60 ? 'medium' : 'low'
  };
}</pre>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚³ã‚¹ãƒˆæœ€é©åŒ–</h2>
            
            <div class="performance-stats">
                <div class="stat-card">
                    <div class="stat-number">~3ç§’</div>
                    <div>å‡¦ç†æ™‚é–“</div>
                    <small>OCR + ChatGPT</small>
                </div>
                <div class="stat-card">
                    <div class="stat-number">~50å††</div>
                    <div>å‡¦ç†å˜ä¾¡</div>
                    <small>1ä»¶ã‚ãŸã‚Š</small>
                </div>
                <div class="stat-card">
                    <div class="stat-number">95%</div>
                    <div>æŠ½å‡ºç²¾åº¦</div>
                    <small>åŸºæœ¬æƒ…å ±</small>
                </div>
                <div class="stat-card">
                    <div class="stat-number">1,000ä»¶</div>
                    <div>æœˆé–“å‡¦ç†å¯èƒ½</div>
                    <small>ç´„5ä¸‡å††äºˆç®—</small>
                </div>
            </div>

            <h3>ğŸ’¡ æœ€é©åŒ–ã®ãƒã‚¤ãƒ³ãƒˆ</h3>
            <ul>
                <li><span class="highlight">Temperatureè¨­å®š</span>: 0.1ã§å®‰å®šã—ãŸçµæœ</li>
                <li><span class="highlight">Max Tokensåˆ¶é™</span>: ç„¡é§„ãªå‡ºåŠ›ã‚’æŠ‘åˆ¶</li>
                <li><span class="highlight">ãƒ¢ãƒ‡ãƒ«é¸æŠ</span>: GPT-4o-miniã§ã‚³ã‚¹ãƒˆå‰Šæ¸›</li>
                <li><span class="highlight">ãƒãƒƒãƒå‡¦ç†</span>: è¤‡æ•°PDFã®åŠ¹ç‡çš„å‡¦ç†</li>
            </ul>
        </section>

        <section class="section">
            <h2>âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨å¯¾ç­–</h2>
            
            <div class="warning-box">
                <h3>ğŸš¨ ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºç­–</h3>
                <ul>
                    <li><strong>Rate Limit Error:</strong> ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–“éš”ã®èª¿æ•´</li>
                    <li><strong>Token Limit Error:</strong> å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã®åˆ†å‰²</li>
                    <li><strong>API Key Error:</strong> ã‚­ãƒ¼ã®æœ‰åŠ¹æ€§ç¢ºèª</li>
                    <li><strong>JSON Parse Error:</strong> å‡ºåŠ›å½¢å¼ã®æ¤œè¨¼</li>
                </ul>
            </div>

            <div class="code-section">
                <h4>åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</h4>
                <pre>function processOrderPDFComplete(fileId) {
  try {
    console.log('=== PDFå‡¦ç†çµ±åˆãƒ•ãƒ­ãƒ¼é–‹å§‹ ===');
    
    // Step 1: OCRå‡¦ç†
    const ocrText = performOCR(DriveApp.getFileById(fileId).getBlob());
    if (!ocrText) {
      throw new Error('OCRå‡¦ç†ãŒå¤±æ•—ã—ã¾ã—ãŸ');
    }
    
    // Step 2: ChatGPT ã«ã‚ˆã‚‹æƒ…å ±æŠ½å‡º
    const extractedInfo = extractOrderInfo(ocrText);
    if (extractedInfo.extraction_failed) {
      throw new Error('æƒ…å ±æŠ½å‡ºãŒå¤±æ•—ã—ã¾ã—ãŸ: ' + extractedInfo.error);
    }
    
    // Step 3: çµæœã®æ¤œè¨¼
    const validationResult = validateExtractedData(extractedInfo);
    
    return {
      success: true,
      file_id: fileId,
      extracted_info: extractedInfo,
      validation: validationResult,
      processed_at: new Date().toISOString()
    };
    
  } catch (error) {
    console.error('çµ±åˆå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
    return {
      success: false,
      error: error.message,
      file_id: fileId,
      processed_at: new Date().toISOString()
    };
  }
}</pre>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ§ª å‹•ç”»4ã®8ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆã§çµ±åˆãƒ†ã‚¹ãƒˆ</h2>
            
            <div class="success-box">
                <h3>ğŸ¯ å‹•ç”»4ã¨ã®é€£æº</h3>
                <p>å‹•ç”»4ã§ä½œæˆãƒ»æ¤œè¨¼ã—ãŸ<span class="highlight">8ç¨®é¡ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆ</span>ã‚’ä½¿ã£ã¦ã€çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ§˜ã€…ãªå®Ÿéš›ã®ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã§ãã‚‹ã“ã¨ã‚’å®Ÿè¨¼ã—ã¾ã™ã€‚</p>
            </div>

            <h3>æ®µéšçš„ãƒ†ã‚¹ãƒˆæ‰‹é †</h3>
            <ol>
                <li><strong>å‹•ç”»4ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆ:</strong> 8ç¨®é¡ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆã§å‹•ä½œç¢ºèª</li>
                <li><strong>çµ±åˆãƒ†ã‚¹ãƒˆ:</strong> å‹•ç”»3ã®OCRâ†’å‹•ç”»4ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ†’å‹•ç”»5ã®å“è³ªæ¤œè¨¼</li>
                <li><strong>è² è·ãƒ†ã‚¹ãƒˆ:</strong> è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®é€£ç¶šå‡¦ç†</li>
                <li><strong>ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ:</strong> ç•°å¸¸ç³»ã§ã®å‹•ä½œç¢ºèª</li>
            </ol>

            <div class="code-section">
                <h4>å‹•ç”»4ã®8ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆå…¨ãƒ†ã‚¹ãƒˆé–¢æ•°</h4>
                <pre>function testAllSampleTexts() {
  console.log('=== å‹•ç”»4ã®8ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆ ===');
  
  const sampleTexts = getSampleTextsFromVideo4();
  const results = [];
  
  sampleTexts.forEach((sample, index) => {
    console.log(`\n--- ã‚µãƒ³ãƒ—ãƒ«${index + 1}ãƒ†ã‚¹ãƒˆé–‹å§‹ ---`);
    console.log('ã‚µãƒ³ãƒ—ãƒ«å:', sample.name);
    
    // å‹•ç”»4ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ + å‹•ç”»5ã®ChatGPT APIå‘¼ã³å‡ºã—
    const result = extractOrderInfo(sample.text);
    
    // å‹•ç”»5ã®å“è³ªæ¤œè¨¼
    const validation = validateExtractedData(result);
    
    console.log('æŠ½å‡ºçµæœ:', JSON.stringify(result, null, 2));
    console.log('å“è³ªã‚¹ã‚³ã‚¢:', validation.score);
    console.log('ä¿¡é ¼åº¦ãƒ¬ãƒ™ãƒ«:', validation.confidence_level);
    
    results.push({
      sample_name: sample.name,
      extraction_result: result,
      validation: validation,
      success: !result.extraction_failed
    });
  });
  
  // å…¨ä½“çµ±è¨ˆ
  const successCount = results.filter(r => r.success).length;
  console.log(`\n=== çµ±åˆãƒ†ã‚¹ãƒˆçµæœ ===`);
  console.log(`æˆåŠŸ: ${successCount}/${results.length}`);
  console.log(`æˆåŠŸç‡: ${(successCount/results.length*100).toFixed(1)}%`);
  
  return results;
}</pre>
            </div>

            <div class="code-section">
                <h4>ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨çµ±åˆå‡¦ç†</h4>
                <pre>function demonstrateIntegratedProcessing() {
  console.log('=== å‹•ç”»1-5çµ±åˆå‡¦ç†ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ===');
  
  // å‹•ç”»4ã®ã‚µãƒ³ãƒ—ãƒ«1ï¼ˆæ¨™æº–çš„ãªæ³¨æ–‡æ›¸ï¼‰ã‚’ä½¿ç”¨
  const sampleTexts = getSampleTextsFromVideo4();
  const standardSample = sampleTexts[0]; // ã‚µãƒ³ãƒ—ãƒ«1: æ¨™æº–çš„ãªæ³¨æ–‡æ›¸
  
  console.log('ä½¿ç”¨ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«:', standardSample.name);
  console.log('OCRãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ¨¡æ“¬ï¼‰:', standardSample.text.substring(0, 100) + '...');
  
  // å‹•ç”»4ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ + å‹•ç”»5ã®APIå‘¼ã³å‡ºã—
  const result = extractOrderInfo(standardSample.text);
  console.log('\næŠ½å‡ºçµæœ:', JSON.stringify(result, null, 2));
  
  // å‹•ç”»5ã®å“è³ªæ¤œè¨¼
  const validation = validateExtractedData(result);
  console.log('\næ¤œè¨¼çµæœ:', JSON.stringify(validation, null, 2));
  
  // çµ±åˆå‡¦ç†æˆåŠŸã®åˆ¤å®š
  if (!result.extraction_failed && validation.score >= 80) {
    console.log('\nğŸ‰ å‹•ç”»1-5çµ±åˆå‡¦ç†æˆåŠŸï¼');
    console.log('OCRâ†’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆâ†’APIâ†’æ¤œè¨¼ã®å…¨ãƒ•ãƒ­ãƒ¼ãŒæ­£å¸¸å‹•ä½œã—ã¦ã„ã¾ã™');
  } else {
    console.log('\nâš ï¸ çµ±åˆå‡¦ç†ã«èª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
  }
}</pre>
            </div>
        </section>

        <section class="section">
            <h2>ğŸ”— æ¬¡å›ã¸ã®æº–å‚™</h2>
            <div class="success-box">
                <h3>ğŸ‰ å‹•ç”»1-5çµ±åˆå®Œæˆï¼</h3>
                <p>å‹•ç”»1ã®å¤¢ã‹ã‚‰å§‹ã¾ã‚Šã€å‹•ç”»2ã®APIåŸºç›¤ã€å‹•ç”»3ã®OCRã€å‹•ç”»4ã®8ã‚µãƒ³ãƒ—ãƒ«æ¤œè¨¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€ãã—ã¦å‹•ç”»5ã®çµ±åˆå®Ÿè£…ã€‚<span class="highlight">ã™ã¹ã¦ãŒä¸€ã¤ã«ã¤ãªãŒã£ãŸå®Œå…¨è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ </span>ãŒå®Œæˆã—ã¾ã—ãŸï¼</p>
                <p>ã“ã‚Œã§ã€PDFã‹ã‚‰æ§‹é€ åŒ–ã•ã‚ŒãŸæƒ…å ±ã‚’è‡ªå‹•æŠ½å‡ºã—ã€å“è³ªæ¤œè¨¼ã¾ã§è¡Œã†æœ¬æ ¼çš„ãªã‚·ã‚¹ãƒ†ãƒ ãŒç¨¼åƒã—ã¦ã„ã¾ã™ã€‚</p>
            </div>

            <div class="warning-box">
                <h3>ğŸ¯ ä»Šå›å®Ÿç¾ã—ãŸçµ±åˆæ©Ÿèƒ½</h3>
                <ul>
                    <li><strong>å‹•ç”»3çµ±åˆ:</strong> Vision API OCRå‡¦ç†ã®çµ„ã¿è¾¼ã¿</li>
                    <li><strong>å‹•ç”»4çµ±åˆ:</strong> 8ã‚µãƒ³ãƒ—ãƒ«æ¤œè¨¼æ¸ˆã¿ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å®Ÿè£…</li>
                    <li><strong>æ–°æ©Ÿèƒ½:</strong> åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ (testAllSampleTexts)</li>
                    <li><strong>æ–°æ©Ÿèƒ½:</strong> ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–¢æ•° (runVideo5MainProcess)</li>
                    <li><strong>æ–°æ©Ÿèƒ½:</strong> å“è³ªæ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ  (validateExtractedData)</li>
                </ul>
            </div>

            <h3>æ¬¡å›äºˆå‘Šï¼šå‹•ç”»6ã€Œã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè‡ªå‹•è¨˜éŒ²ã€</h3>
            <p>æŠ½å‡ºã•ã‚ŒãŸæƒ…å ±ã‚’<span class="highlight">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã—ã¦è“„ç©ãƒ»ç®¡ç†</span>ã™ã‚‹ä»•çµ„ã¿ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>
            
            <ul>
                <li>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸ã®è‡ªå‹•è¨˜éŒ²æ©Ÿèƒ½</li>
                <li>å‡¦ç†æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•æ•´ç†</li>
                <li>ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ã¨ç®¡ç†</li>
                <li>æ¤œç´¢ãƒ»åˆ†ææ©Ÿèƒ½ã®åŸºç›¤æ§‹ç¯‰</li>
            </ul>

            <p>AIãŒæŠ½å‡ºã—ãŸæƒ…å ±ã‚’ã€ãƒ“ã‚¸ãƒã‚¹ã§æ´»ç”¨ã§ãã‚‹ã€Œè³‡ç”£ã€ã«å¤‰ãˆã¦ã„ãã¾ã™ï¼</p>
        </section>
    </div>
</body>
</html>