# 動画2: Google Cloud & GAS 3つの重要APIを有効化する方法

## 📝 セリフと流れ（13分構成）

### 🎬 オープニング（0:00-1:00）
**セリフ**:
「『API』『GCP』…なんだか難しそう？大丈夫です。ここは、未来の自分のために高速道路を建設するようなもの。一度作ってしまえば、あとは快適に走り続けるだけ。

一つ一つ、画面を見ながら一緒に設定していけば、誰でも必ず完了できます。この10分で、あなたのGoogleアカウントを『自動化マシン』に変身させましょう！

今回有効化するのは3つのAPI。Drive API、Gmail API、そしてVision API。これらが、私たちのPDF自動処理システムの心臓部となります。」

**画面表示**: API設定の全体フロー図

---

### 🗂️ フォルダ構造の準備（1:00-2:30）
**セリフ**:
「まず、作業の基盤となるフォルダ構造を整えます。シンプルが一番。『AI受注処理』と『処理済み』、この2つのフォルダだけです。

Google Driveを開いて、右クリックから『新しいフォルダ』を選択。名前は『AI受注処理』。これが、PDFを投入する入り口になります。

同じように『処理済み』フォルダも作成。こちらは、処理が完了したPDFの保管場所です。

このフォルダ分けによって、処理状況が一目でわかるようになります。『今どのPDFが処理待ちなのか』『どれが完了済みなのか』が瞬時に判別できる、プロフェッショナルな管理システムの基盤が完成しました。」

**画面表示**: 
- Google Driveでのフォルダ作成手順
- 完成したフォルダ構造

---

### 📊 スプレッドシート受注台帳の作成（2:30-4:00）
**セリフ**:
「次に、抽出したデータを保存する『受注管理台帳』を作成します。Google Driveで『新規』→『Googleスプレッドシート』を選択。

ファイル名は『受注管理台帳』。この台帳が、私たちのビジネスの中枢データベースになります。

ヘッダー行を設定しましょう。A1セルから順に：
- 処理日時
- ステータス  
- 会社名
- 担当者名
- 商品名
- 数量
- 合計金額
- ファイル名

このシンプルな8項目で、受注業務に必要な情報を全て管理できます。これ以上複雑にする必要はありません。シンプルこそが、長期間安定して運用できる秘訣です。」

**画面表示**: 
- スプレッドシート作成手順
- ヘッダー設定の様子

---

### ⚙️ Google Apps Script環境の準備（4:00-5:30）
**セリフ**:
「いよいよ、自動化の頭脳となるGoogle Apps Scriptの設定です。作成したスプレッドシートから『拡張機能』→『Apps Script』を選択。

新しいタブが開き、コードエディタが表示されます。これが、私たちのAIシステムの司令塔。ここで、PDF処理の全ての流れをコントロールします。

プロジェクト名を『PDF自動処理システム』に変更。デフォルトのmyFunction()は削除して、まっさらな状態にします。

この環境で、次回からは実際のコードを書いていきます。プログラミング初心者の方も安心してください。複雑なコードは一切書きません。コピー&ペーストと、少しの設定変更だけで完成します。」

**画面表示**: 
- Apps Script起動手順
- エディタ画面の説明

---

### 🔌 3つのAPI有効化（5:30-8:30）
**セリフ**:
「ここからが本題。3つのAPIを順番に有効化していきます。初心者の方でも迷わないよう、画面を一緒に見ながら進めましょう。

**🚀 Drive APIとGmail API（Apps Script経由）**
まず、Drive APIとGmail API。これらはApps Scriptから簡単に追加できます。

スクリプトエディタの左側『サービス』の『+』マークをクリック。『Drive API』を検索して追加。これで、フォルダ内のファイルを監視し、新しいPDFが追加されたことを検知できるようになります。

同じように『Gmail API』も追加。お客様への自動返信メールを送信するために必要です。

**🎯 Vision API（Google Cloud Console経由）**
さて、ここからが今回の主役、Vision API。これが、PDFの文字を読み取るAIの『目』となります。

新しいタブでGoogle Cloud Consoleを開きます。URLは console.cloud.google.com です。

まず、新しいプロジェクトを作成。『プロジェクトを選択』→『新しいプロジェクト』→プロジェクト名は『PDF自動処理』にしましょう。

プロジェクトが作成されたら、『APIとサービス』→『ライブラリ』を選択。検索欄に『Vision』と入力し、『Cloud Vision API』を見つけて『有効にする』をクリック。

『Vision APIが有効になりました』と表示されれば成功です。

**🔑 APIキーの取得**
次に、重要なAPIキーを取得します。『認証情報』→『認証情報を作成』→『APIキー』を選択。

生成されたAPIキーをコピーして、Apps Scriptのプロパティに保存します。スクリプトエディタで『プロジェクトの設定』→『スクリプト プロパティ』→『スクリプト プロパティを追加』。

プロパティ名：VISION_API_KEY
値：先ほどコピーしたAPIキー

これで準備完了。この3つのAPIで、『見る』『読む』『送る』の全ての機能が揃いました。」

**画面表示**: 
- Apps Scriptでのサービス追加手順
- GCPコンソールでのVision API有効化手順
- APIキー取得と設定方法

---

### ✅ 設定確認とテスト（8:30-12:00）
**セリフ**:
「設定が完了したら、必ず動作確認を行います。プロの鉄則です。『急がば回れ』。この段階で確実に基盤を固めることで、次回以降の作業がスムーズに進みます。

**📝 基本接続テスト**
まず、Apps Scriptとスプレッドシートが正しく連携できるか確認しましょう。

スクリプトエディタに戻り、次のテストコードを入力します：

```javascript
function testBasicSetup() {
  // スプレッドシート接続テスト
  const sheet = SpreadsheetApp.getActiveSheet();
  sheet.getRange('A2').setValue('テスト: ' + new Date());
  console.log('スプレッドシート接続: OK');
}
```

『実行』ボタンをクリック。権限の許可を求められたら『許可』を選択。スプレッドシートのA2セルに現在時刻が表示されれば成功です。

**💾 Drive API動作確認**
次に、Drive APIが正常に動作するかテストします：

```javascript
function testDriveAPI() {
  try {
    // 作成したフォルダを検索
    const folders = DriveApp.getFoldersByName('AI受注処理');
    if (folders.hasNext()) {
      const folder = folders.next();
      console.log('AI受注処理フォルダ発見: ' + folder.getId());
      
      // フォルダ内のファイル数を確認
      const files = folder.getFiles();
      let count = 0;
      while (files.hasNext()) {
        files.next();
        count++;
      }
      console.log('フォルダ内ファイル数: ' + count);
      console.log('Drive API: 正常動作');
    }
  } catch (error) {
    console.error('Drive APIエラー:', error);
  }
}
```

実行して、コンソールに『Drive API: 正常動作』と表示されれば成功です。

**👁️ Vision API接続テスト**
最後に、Vision APIの接続確認です。実際の画像は使わず、接続だけをテストします：

```javascript
function testVisionAPIConnection() {
  try {
    const apiKey = PropertiesService.getScriptProperties().getProperty('VISION_API_KEY');
    
    if (!apiKey) {
      console.error('APIキーが設定されていません');
      return;
    }
    
    console.log('Vision APIキー設定済み');
    console.log('APIキー確認: ' + (apiKey.length > 0 ? 'OK' : 'NG'));
    
    // Vision APIのエンドポイントURLを確認
    const visionUrl = `https://vision.googleapis.com/v1/images:annotate?key=${apiKey}`;
    console.log('Vision API接続準備完了');
    
  } catch (error) {
    console.error('Vision API設定エラー:', error);
  }
}
```

これで、3つのAPIすべての基本動作が確認できました。

**🔍 総合動作テスト**
最後に、すべての設定をまとめてテストする統合確認を行います：

```javascript
function comprehensiveTest() {
  console.log('=== PDF自動処理システム 総合テスト開始 ===');
  
  try {
    // 1. スプレッドシート接続
    const sheet = SpreadsheetApp.getActiveSheet();
    sheet.getRange('A2').setValue('システムテスト: ' + new Date());
    console.log('✅ スプレッドシート接続: OK');
    
    // 2. Drive API
    DriveApp.getFoldersByName('AI受注処理');
    console.log('✅ Drive API: OK');
    
    // 3. Gmail API（読み取り権限のみテスト）
    GmailApp.getInboxThreads(0, 1);
    console.log('✅ Gmail API: OK');
    
    // 4. Vision API設定確認
    const apiKey = PropertiesService.getScriptProperties().getProperty('VISION_API_KEY');
    if (apiKey && apiKey.length > 30) {
      console.log('✅ Vision API設定: OK');
    } else {
      console.log('⚠️ Vision APIキー要確認');
    }
    
    console.log('=== 総合テスト完了：システム準備OK ===');
    
  } catch (error) {
    console.error('❌ テストエラー:', error);
    console.log('エラー箇所を確認して修正してください');
  }
}
```

このテストをすべて実行して、エラーがなければ、次回のOCR実装に進む準備が整いました。」

**画面表示**: 
- テストコードの入力・実行手順
- コンソール出力の確認方法
- エラー発生時の対処法説明

---

### 🔚 まとめと次回予告（12:00-13:00）
**セリフ**:
「お疲れさまでした！これで、PDF自動処理システムの『土台』が完成しました。

今日設定した3つのAPI、そして作成したフォルダとスプレッドシートが、これから構築する自動化システムの基盤となります。

次回は、いよいよVision APIを使って、PDFから文字を読み取る実装に入ります。『AIがPDFを読む』瞬間を、一緒に体験しましょう。

『PDFの内容をAIに"読ませる" - Vision APIで全ての文字をテキスト化する』でお会いしましょう！」

**画面表示**: 
- 今回の成果まとめ
- 次回動画のプレビュー

---

## 📋 撮影チェックリスト

### 事前準備
- [ ] GCPアカウントの準備と動作確認
- [ ] 各API有効化の手順確認
- [ ] サンプルスプレッドシートの準備
- [ ] 操作手順のリハーサル

### 撮影時の注意点
- [ ] 画面操作をゆっくり、明確に
- [ ] エラーが発生した場合の対処法も説明
- [ ] 初心者にとって分かりにくい部分の詳細説明
- [ ] 設定完了の確認方法の明示

### 必要な画面録画
- [ ] フォルダ作成の全手順
- [ ] スプレッドシート作成とヘッダー設定
- [ ] Apps Script起動と初期設定
- [ ] 3つのAPI有効化の全プロセス
- [ ] 動作確認テストの様子