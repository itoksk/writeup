# 第3回：完成！GASで動く日報アプリとGoogleサイト公開
# 使用プロンプト集

---

## 📝 この回で使うプロンプト一覧

1. **プロンプト1**: フォーム送信時の自動転記コード（前回の復習）
2. **プロンプト2**: 日報閲覧用のHTMLアプリ作成（メインプロンプト）
3. **プロンプト3**: エラー対処・カスタマイズ用

---

## プロンプト1: フォーム送信時の自動転記コード（復習）

### 使用タイミング
前回のコードを再確認したいとき、またはトリガー設定の前にコードを確認したいとき

### プロンプト本文

```
Google Apps Scriptで、Googleフォームの送信内容をスプレッドシートに転記するコードを作成してください。

【技術仕様】
- プラットフォーム: Google Apps Script
- イベントトリガー: フォーム送信時（onFormSubmit）
- 対象サービス: Googleフォーム、Googleスプレッドシート

【フォーム項目（項目順）】
1. 日付（日付形式）
2. 氏名（短い回答）
3. 業務内容（段落形式）
4. 所感・気づき（段落形式）

【スプレッドシートの列構成】
- A列: タイムスタンプ（送信日時）
- B列: 日付
- C列: 氏名
- D列: 業務内容
- E列: 所感・気づき
- シート名: 「シート1」

【処理フロー】
1. フォーム送信イベント（e）を受け取る
2. 送信内容（itemResponses）を取得
3. タイムスタンプを生成（new Date()）
4. 各項目の値を取得
5. スプレッドシートの最終行に追加（appendRow）

【コード要件】
- 関数名: onFormSubmit
- 引数: e（フォーム送信イベントオブジェクト）
- 各行に日本語コメントを付ける
- 変数名は分かりやすい名前を使用

上記の仕様に従って、Google Apps Scriptのコードを生成してください。
```

---

## プロンプト2: 日報閲覧用のHTMLアプリ作成（★重要★）

### 使用タイミング
動画内デモ、受講者がWebアプリを作成するとき

### プロンプト本文

```
Google Apps Scriptで、スプレッドシートの日報データを閲覧できるWebアプリを作成してください。

【技術仕様】
- プラットフォーム: Google Apps Script（GAS）
- 構成: バックエンド（Code.gs）+ フロントエンド（Index.html）
- デプロイ方法: Webアプリとして公開
- 埋め込み: Googleサイトに埋め込み可能にする

【データソース】
- スプレッドシート名: アクティブなスプレッドシート
- シート名: 「シート1」
- 列構成:
  - A列: タイムスタンプ（送信日時）
  - B列: 日付
  - C列: 氏名
  - D列: 業務内容
  - E列: 所感・気づき

【必要な機能】
1. **データ表示**
   - スプレッドシートから日報データを読み込む
   - カード形式で見やすく表示
   - 日付の新しい順にソート

2. **フィルター機能**
   - 氏名でフィルター（プルダウン選択）
   - 検索ボックスで業務内容や所感を検索

3. **デザイン**
   - シンプルで見やすいUI
   - レスポンシブデザイン（スマホ対応）
   - カード型のレイアウト

【ファイル構成】
1. **Code.gs（バックエンド）**
   - doGet(): HTMLページを返す関数
   - getDailyReports(): スプレッドシートからデータを取得する関数
   - getNameList(): 氏名のリストを取得する関数（フィルター用）

2. **Index.html（フロントエンド）**
   - HTML構造
   - CSSスタイル（見やすいカードデザイン）
   - JavaScriptでデータ取得・フィルター処理

【重要な設定】
- setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL) を使用
  （Googleサイトへの埋め込みを可能にするため）

【出力要件】
1. Code.gsの完全なコード
2. Index.htmlの完全なコード
3. 各ファイルに詳細なコメントを付ける
4. エラーハンドリングを実装
5. データがない場合の表示も考慮

上記の仕様に従って、Google Apps ScriptのWebアプリのコードを生成してください。
```

### 期待される回答の構成

AIは以下のような構成でコードを返してくれます：

**1. Code.gs（バックエンド）**
```javascript
function doGet() {
  return HtmlService.createHtmlOutputFromFile('Index')
    .setTitle('業務日報 - 閲覧アプリ')
    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}

function getDailyReports() {
  // スプレッドシートからデータを取得
  // ...
}

function getNameList() {
  // 氏名リストを取得
  // ...
}
```

**2. Index.html（フロントエンド）**
```html
<!DOCTYPE html>
<html>
<head>
  <!-- スタイル -->
</head>
<body>
  <!-- HTML構造 -->
  <script>
    // JavaScriptでデータ取得・フィルター処理
  </script>
</body>
</html>
```

---

## プロンプト3: Webアプリ公開後のカスタマイズ

### 使用タイミング
基本のWebアプリが動いた後、機能を追加したいとき

### プロンプト本文（テンプレート）

```
以下のGoogle Apps Script Webアプリに、機能を追加してください。

【現在のコード】
Code.gs:
```javascript
[ここに現在のCode.gsを貼り付け]
```

Index.html:
```html
[ここに現在のIndex.htmlを貼り付け]
```

【追加したい機能】
- [例: 日付範囲でフィルターする機能を追加したい]
- [例: データをCSVでエクスポートする機能を追加したい]
- [例: グラフ表示機能を追加したい]

【出力要件】
1. 修正後のCode.gsの完全なコード
2. 修正後のIndex.htmlの完全なコード
3. 変更箇所に「// 🔄 追加: 〇〇機能」のようなコメントを付ける
4. 新しい機能の使い方を説明

上記に従って、コードを修正してください。
```

---

## 📌 Webアプリの公開手順（AIには聞かない手順）

### 1. Apps Scriptエディタでの作業

1. **Code.gsファイル**
   - 既存の `onFormSubmit` 関数はそのまま残す
   - AIが生成した `doGet()`, `getDailyReports()`, `getNameList()` を追加

2. **Index.htmlファイルの作成**
   - Apps Scriptエディタで、左メニューの「＋」→「HTML」を選択
   - ファイル名: `Index`
   - AIが生成したHTMLコードを貼り付け

3. **保存**
   - すべてのファイルを保存

### 2. Webアプリとして公開

1. **デプロイ**
   - 右上の「デプロイ」→「新しいデプロイ」をクリック

2. **種類の選択**
   - 「種類の選択」（歯車アイコン）→「ウェブアプリ」を選択

3. **設定**
   - 説明: `日報閲覧アプリ`
   - 次のユーザーとして実行: `自分`
   - アクセスできるユーザー: `組織内の全員`（または `自分のみ`）

4. **権限の承認**
   - 初回は権限の承認が求められます
   - 「アクセスを承認」→自分のアカウントを選択→「許可」

5. **WebアプリURLの取得**
   - デプロイが完了すると、WebアプリURLが表示されます
   - このURLをコピーしておきます

### 3. Googleサイトに埋め込み

1. **Google Sitesを開く**
   - sites.google.com にアクセス
   - 「新しいサイトを作成」（または既存のサイトを開く）

2. **サイトの基本設定**
   - サイト名: `業務日報 - チーム共有`
   - 必要に応じてページを追加

3. **Webアプリの埋め込み**
   - 右側の「挿入」メニューから「埋め込み」を選択
   - 「URL」タブを選択
   - 先ほどコピーしたWebアプリURLを貼り付け
   - 「挿入」をクリック

4. **サイズ調整**
   - 埋め込まれたアプリのサイズを調整
   - 高さ: 600px以上推奨

5. **公開設定**
   - 右上の「公開」ボタンをクリック
   - 公開範囲: `組織内の全員`（または `特定のユーザー`）
   - 「公開」をクリック

6. **URLの共有**
   - 公開されたサイトのURLをチームに共有

---

## 💡 よくある質問とトラブルシューティング

### Q1: Webアプリにアクセスすると「権限が必要です」と表示される

**A1**: 以下を確認してください：
1. デプロイ時の「次のユーザーとして実行」が「自分」になっているか
2. 「アクセスできるユーザー」が正しく設定されているか
3. 権限の承認が完了しているか

### Q2: Googleサイトに埋め込んだが、アプリが表示されない

**A2**: 以下を確認してください：
1. Code.gs の doGet() 関数に `.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL)` が含まれているか
2. WebアプリURLが正しくコピーされているか
3. ブラウザのキャッシュをクリアしてみる

### Q3: データが表示されない

**A3**: 以下を確認してください：
1. スプレッドシートのシート名が「シート1」になっているか
2. スプレッドシートにデータが入っているか（ヘッダー行除く）
3. Apps Scriptの実行ログでエラーが出ていないか

### Q4: フィルターが動かない

**A4**: 以下を確認してください：
1. Index.html のJavaScriptコードが正しく貼り付けられているか
2. ブラウザの開発者ツール（F12）でJavaScriptエラーが出ていないか
3. 氏名のデータが正しくスプレッドシートに入っているか

---

## 🎯 カスタマイズのアイデア

### 1. 日付範囲フィルター

AIに以下のように依頼：
```
日付範囲でフィルターする機能を追加してください。
開始日と終了日を入力できるようにし、その期間の日報のみを表示します。
```

### 2. グラフ表示

AIに以下のように依頼：
```
氏名別の日報提出数を円グラフで表示する機能を追加してください。
Chart.jsライブラリを使用してください。
```

### 3. CSVエクスポート

AIに以下のように依頼：
```
表示されている日報データをCSVファイルとしてダウンロードできる機能を追加してください。
ボタンをクリックすると、CSVファイルがダウンロードされるようにします。
```

### 4. 印刷用レイアウト

AIに以下のように依頼：
```
印刷用のレイアウトを追加してください。
「印刷」ボタンをクリックすると、印刷に適した形式で日報が表示されるようにします。
```

---

## 📚 参考情報

### Google Apps Script 公式ドキュメント

- **Webアプリ**: https://developers.google.com/apps-script/guides/web
- **HTMLService**: https://developers.google.com/apps-script/reference/html/html-service
- **SpreadsheetApp**: https://developers.google.com/apps-script/reference/spreadsheet

### Google Sites 公式ヘルプ

- **サイトの作成**: https://support.google.com/sites/answer/6372878
- **コンテンツの埋め込み**: https://support.google.com/sites/answer/90569

---

## 🎓 学習のポイント

### 1. GASでWebアプリを作る意義

- スプレッドシートをそのまま共有するのではなく、**見やすいUIで表示**できる
- **アクセス権限を細かく制御**できる
- **フィルターや検索機能**を簡単に追加できる
- **Googleサイトに埋め込む**ことで、チーム全員がアクセスできる

### 2. HTMLとGASの連携

- `google.script.run` を使って、HTMLからGAS関数を呼び出せる
- `withSuccessHandler` でデータ取得成功時の処理を書く
- `withFailureHandler` でエラー時の処理を書く

### 3. Webアプリ公開の仕組み

- `doGet()` 関数がWebアプリのエントリーポイント
- HtmlService でHTMLファイルを返す
- `setXFrameOptionsMode` でGoogleサイトへの埋め込みを許可

---

**ファイル作成日**: 2025-10-31
**対象動画**: 第3回（9分）
**使用ツール**: Google Apps Script、Googleサイト、スプレッドシート、HtmlService
**次回**: 見積書自動生成システム（Docsテンプレート×GAS）
