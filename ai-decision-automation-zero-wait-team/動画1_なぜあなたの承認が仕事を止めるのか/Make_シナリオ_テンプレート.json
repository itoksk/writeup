{
  "name": "AIæ‰¿èªã‚·ã‚¹ãƒ†ãƒ  - ãƒ‡ãƒ¢ã‚·ãƒŠãƒªã‚ª",
  "description": "Slackã®æ‰¿èªä¾é ¼ã‚’ChatGPTã§è‡ªå‹•åˆ¤æ–­ã—ã€çµæœã‚’è¿”ä¿¡ã™ã‚‹ã‚·ãƒŠãƒªã‚ª",
  "version": "1.0.0",
  "modules": [
    {
      "id": 1,
      "name": "Slack - Watch Messages",
      "type": "trigger",
      "module": "slack:watchPublicChannelMessages",
      "config": {
        "channel": "#approval-requests",
        "filter": {
          "text": {
            "contains": "æ‰¿èªä¾é ¼"
          }
        }
      },
      "description": "æ‰¿èªä¾é ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç›£è¦–"
    },
    {
      "id": 2,
      "name": "Data Parser",
      "type": "transformer",
      "module": "builtin:dataParser",
      "config": {
        "parseRules": {
          "amount": {
            "pattern": "(\\d+)ä¸‡å††",
            "type": "number",
            "multiplier": 10000
          },
          "requestType": {
            "pattern": "ã€æ‰¿èªä¾é ¼ã€‘(.+?)\\n",
            "type": "string"
          }
        }
      },
      "description": "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰é‡‘é¡ã‚„æ¡ˆä»¶åã‚’æŠ½å‡º"
    },
    {
      "id": 3,
      "name": "ChatGPT API",
      "type": "action",
      "module": "http:makeRequest",
      "config": {
        "url": "https://api.openai.com/v1/chat/completions",
        "method": "POST",
        "headers": {
          "Authorization": "Bearer {{OPENAI_API_KEY}}",
          "Content-Type": "application/json"
        },
        "body": {
          "model": "gpt-4",
          "messages": [
            {
              "role": "system",
              "content": "ã‚ãªãŸã¯çµŒé¨“è±Šå¯Œãªç®¡ç†è·ã¨ã—ã¦ã€æ‰¿èªæ¥­å‹™ã‚’æ‹…å½“ã—ã¾ã™ã€‚\n\nåˆ¤æ–­åŸºæº–:\n- é‡‘é¡åŸºæº–: 10ä¸‡å††ä»¥ä¸‹ã¯åŸå‰‡æ‰¿èªã€50ä¸‡å††è¶…ã¯è©³ç´°æ¤œè¨\n- ROIåŸºæº–: æŠ•è³‡å›åæœŸé–“12ãƒ¶æœˆä»¥å†…ã‚’ç›®å®‰\n- ãƒªã‚¹ã‚¯è©•ä¾¡: ä¼šç¤¾ã¸ã®æ½œåœ¨çš„å½±éŸ¿åº¦ã‚’3æ®µéšã§è©•ä¾¡\n- éå»äº‹ä¾‹: é¡ä¼¼æ¡ˆä»¶ã®çµæœã‚’å‚è€ƒã«åˆ¤æ–­\n\nå‡ºåŠ›ã¯å¿…ãšä»¥ä¸‹ã®JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„:\n{\n  \"decision\": \"æ‰¿èª/æ¡ä»¶ä»˜ãæ‰¿èª/å´ä¸‹\",\n  \"reasoning\": \"åˆ¤æ–­æ ¹æ‹ ï¼ˆ100æ–‡å­—ä»¥å†…ï¼‰\",\n  \"confidence\": ä¿¡é ¼åº¦ï¼ˆ0-100ã®æ•°å€¤ï¼‰,\n  \"notes\": \"æ³¨æ„äº‹é …\"\n}"
            },
            {
              "role": "user",
              "content": "{{1.text}}"
            }
          ],
          "temperature": 0.7,
          "max_tokens": 500,
          "response_format": {
            "type": "json_object"
          }
        }
      },
      "description": "ChatGPTã§æ‰¿èªåˆ¤æ–­ã‚’å®Ÿè¡Œ"
    },
    {
      "id": 4,
      "name": "Parse ChatGPT Response",
      "type": "transformer",
      "module": "builtin:jsonParser",
      "config": {
        "jsonString": "{{3.body.choices[0].message.content}}"
      },
      "description": "ChatGPTã®å¿œç­”ã‚’ãƒ‘ãƒ¼ã‚¹"
    },
    {
      "id": 5,
      "name": "Slack Reply",
      "type": "action",
      "module": "slack:postMessage",
      "config": {
        "channel": "{{1.channel}}",
        "thread_ts": "{{1.ts}}",
        "blocks": [
          {
            "type": "header",
            "text": {
              "type": "plain_text",
              "text": "ğŸ¤– AIæ‰¿èªã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹åˆ¤æ–­çµæœ"
            }
          },
          {
            "type": "section",
            "fields": [
              {
                "type": "mrkdwn",
                "text": "*åˆ¤æ–­çµæœ:*\n{{4.decision == 'æ‰¿èª' ? 'âœ…' : 'âŒ'}} {{4.decision}}"
              },
              {
                "type": "mrkdwn",
                "text": "*æ‰¿èªã‚³ãƒ¼ãƒ‰:*\nAP-{{formatDate(now, 'YYYY-MMdd-HHmmss')}}"
              }
            ]
          },
          {
            "type": "section",
            "text": {
              "type": "mrkdwn",
              "text": "*åˆ¤æ–­æ ¹æ‹ :*\n{{4.reasoning}}"
            }
          },
          {
            "type": "context",
            "elements": [
              {
                "type": "mrkdwn",
                "text": "AIä¿¡é ¼åº¦: {{4.confidence}}% | å‡¦ç†æ™‚é–“: {{round((now - 1.timestamp) / 1000, 1)}}ç§’"
              }
            ]
          }
        ]
      },
      "description": "Slackã«ã‚¹ãƒ¬ãƒƒãƒ‰è¿”ä¿¡"
    },
    {
      "id": 6,
      "name": "Record to Spreadsheet",
      "type": "action",
      "module": "googlesheets:addRow",
      "config": {
        "spreadsheetId": "{{SPREADSHEET_ID}}",
        "sheetName": "æ‰¿èªå±¥æ­´",
        "values": {
          "A": "{{formatDate(now, 'YYYY/MM/DD HH:mm:ss')}}",
          "B": "{{1.user_name}}",
          "C": "{{1.text}}",
          "D": "{{4.decision}}",
          "E": "{{4.reasoning}}",
          "F": "{{4.confidence}}%",
          "G": "{{round((now - 1.timestamp) / 1000, 1)}}ç§’"
        }
      },
      "description": "æ‰¿èªå±¥æ­´ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¨˜éŒ²"
    }
  ],
  "connections": [
    {
      "from": 1,
      "to": 2
    },
    {
      "from": 2,
      "to": 3
    },
    {
      "from": 3,
      "to": 4
    },
    {
      "from": 4,
      "to": 5
    },
    {
      "from": 4,
      "to": 6
    }
  ],
  "settings": {
    "errorHandling": {
      "continueOnError": false,
      "retryAttempts": 2,
      "retryDelay": 5000
    },
    "scheduling": {
      "enabled": false,
      "interval": "manual"
    }
  },
  "variables": {
    "OPENAI_API_KEY": {
      "type": "string",
      "description": "OpenAI APIã‚­ãƒ¼",
      "required": true
    },
    "SPREADSHEET_ID": {
      "type": "string", 
      "description": "è¨˜éŒ²ç”¨ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID",
      "required": true
    }
  }
}