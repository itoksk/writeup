# 第4回：営業資料を自動で蓄積＆可視化！
## 添付ファイル自動保存 × 週次レポートで営業活動を見える化

---

## この回の目標

第3回で作成した「追客漏れゼロエージェント」に**添付ファイル保存機能**と**スプレッドシートへのログ記録**を追加。さらに**週次レポートエージェント**を新規作成し、営業活動の可視化を実現します。

---

## Before / After

### BEFORE：受講前
- 添付ファイルがメールに埋もれる
- 「あの見積書どこ？」と探す時間
- 今週何をやったか振り返れない
- 営業活動が見えない

### AFTER：受講後
- 添付ファイルが自動でDriveに蓄積
- スプレッドシートでログ管理
- 週次レポートで活動を振り返り
- どの顧客と活発にやり取りしているか一目瞭然

---

## 今回やること

| 作業 | 内容 |
|------|------|
| 作業1 | 既存エージェントの編集（追客漏れゼロエージェントにステップ追加） |
| 作業2 | 週次レポートエージェントの新規作成 |

---

## 週次レポートから分かること

- **活発な商談**：今週どの顧客と多くやり取りしたか
- **営業活動量**：提案書・見積書の送受信数
- **案件の進捗**：提案→見積もり→契約の流れが見える
- **注目案件**：動きが活発な顧客をGeminiが抽出

---

## 事前準備

### 1. Driveフォルダの作成

Google Driveに**「営業資料」**フォルダを作成してください。添付ファイルはこのフォルダに保存されます。

### 2. スプレッドシートの作成

Google Sheetsで**「営業資料ログ」**スプレッドシートを作成し、以下のヘッダー行を設定してください。

| 日付 | 送信者名 | 送信者メール | 件名 | ファイル名 | ファイル種類 | 案件ステージ | 緊急度 |
|------|----------|--------------|------|------------|--------------|--------------|--------|

> **ヒント**
> ヘッダー行（1行目）は必ず設定してください。エージェントはこのヘッダーに従ってデータを追記します。

---

## 作業1：追客漏れゼロエージェントの編集

第3回で作成したエージェントを開き、新しいステップを追加します。

### エージェントの編集方法

Workspace Studioで第3回で作成した「追客漏れゼロエージェント」を開き、「Edit」ボタンをクリックして編集モードに入ります。

### 更新後のフロー

```
Gmailスターター（重要顧客 + has:attachment）
    ↓
Geminiステップ（要対応判定）
    ↓
条件分岐（YES）
    ↓
Gmailステップ（ラベル付与）
    ↓
Driveステップ（保存）【NEW】
    ↓
Sheetsステップ（ログ記録）【NEW】
    ↓
Chat DMステップ（通知）
```

### Step 1: フィルター条件の変更

Gmailスターターのフィルターに`has:attachment`を追加して、添付ファイル付きメールも対象にします。

```
(from:yamada@a-corp.co.jp OR from:tanaka@b-inc.com) has:attachment
```

### Step 2: Driveステップを追加（NEW）

| 項目 | 設定 |
|------|------|
| ステップ | Drive - Upload file |
| 保存先 | 「営業資料」フォルダ |
| ファイル | {attachment} |

### Step 3: Sheetsステップを追加（NEW）

| 項目 | 設定 |
|------|------|
| ステップ | Sheets - Add row |
| スプレッドシート | 「営業資料ログ」 |

**追記するデータ：**

| カラム | 値 |
|--------|-----|
| 日付 | {when_email_was_sent} |
| 送信者名 | {sender_name} |
| 送信者メール | {sender_email} |
| 件名 | {email_subject} |
| ファイル名 | {attachment_name} |
| ファイル種類 | {file_type}（Geminiの判定結果） |
| 案件ステージ | {deal_stage}（Geminiの判定結果） |
| 緊急度 | {urgency}（Geminiの判定結果） |

### Step 4: 通知内容の更新

Chat DM通知にファイル保存の情報を追加します。

```
📌 要対応メールを検知しました

【送信者】{sender_name} ({sender_email})
【件名】{email_subject}
【受信日時】{when_email_was_sent}
【緊急度】{urgency}

{email_summary}

📁 添付ファイルを保存しました
【ファイル名】{attachment_name}
【保存先】営業資料フォルダ

📋 次のアクション: {next_action}
📧 メールを確認: {email_link}
```

---

## 作業2：週次レポートエージェントの作成

新しいエージェントを作成し、スプレッドシートのログを分析して週次レポートを生成します。

### フロー

```
スケジュールスターター（毎週月曜9時）
    ↓
Sheetsステップ（ログ読み込み）
    ↓
Geminiステップ（分析）
    ↓
Chat DMステップ（レポート送信）
```

### 作成手順

| Step | 内容 | 詳細 |
|------|------|------|
| 01 | スケジュールスターター設定 | Scheduled / 毎週月曜 9:00 AM / Asia/Tokyo |
| 02 | Sheetsステップ（読み込み） | Sheets - Read spreadsheet / 「営業資料ログ」の全データを取得 |
| 03 | Geminiステップ（分析） | ログデータを分析し、営業活動のサマリーを生成 |
| 04 | Chat DMステップ（送信） | 週次レポートをChat DMで送信 |

### Geminiプロンプト

```
以下は今週の営業資料ログデータです。
このデータを分析して、営業活動の週次レポートを作成してください。

ログデータ:
{sheets_data}

以下の形式で出力してください：

📊 今週の営業活動レポート

【今週の概要】
- 保存されたファイル数と主な種類（提案書、見積書など）を要約

【活発な商談】
- 送信者名/会社ごとにファイル数を集計
- 複数のファイルがある顧客は特に注目

【資料の種類別集計】
- 提案書: X件
- 見積書: X件
- 契約書: X件
- その他: X件

【案件ステージ別状況】
- 問い合わせ: X件
- 提案中: X件
- 見積もり: X件
- 契約交渉: X件

【注目ポイント】
- 緊急度HIGHの案件をリストアップ
- 契約書や見積書がある場合は、商談が進んでいる可能性を指摘
- 今週フォローすべき顧客を提案

データがない場合は「今週は新規データはありません」と出力してください。
```

### 週次レポートの出力例

```
📊 今週の営業活動レポート

【今週の概要】
今週は10件のファイルが保存されました。
提案書3件、見積書3件、契約書2件、その他2件と、複数の商談が活発に動いています。

【活発な商談】
- 山田太郎（A社）：2件（提案書×2）→ 提案書を改訂中
- 鈴木花子（B社）：2件（見積書、発注書）→ 発注段階に進行！
- 佐藤一郎（D社）：1件（契約書）→ 契約交渉中

【資料の種類別集計】
- 提案書: 3件
- 見積書: 3件
- 契約書: 2件
- その他: 2件

【案件ステージ別状況】
- 問い合わせ: 2件
- 提案中: 3件
- 見積もり: 3件
- 契約交渉: 2件

【注目ポイント】
⭐ B社は発注書が届いています！最優先で対応してください。
⭐ D社は契約交渉中。契約締結に向けた最終確認を進めましょう。
⭐ A社は提案書を複数回改訂中。顧客の要望を確認してください。
```

---

## Before / After 比較表

| 項目 | Before | After |
|------|--------|-------|
| 添付ファイル保存 | 手動でダウンロード・アップロード | 自動でDriveに蓄積 |
| ログ管理 | なし（記憶に頼る） | スプレッドシートで自動記録 |
| 資料の検索 | メールを探し回る | Drive・スプレッドシートで即座に検索 |
| 営業活動の把握 | 何をやったか分からない | 週次レポートで可視化 |
| フォローすべき顧客 | 自分で判断 | Geminiが提案 |

---

## 運用のコツ

### スプレッドシートの定期整理
データが溜まってきたら、月1回程度で古いデータを別シートにアーカイブしましょう。Geminiの分析精度も向上します。

### フィルターとソート
スプレッドシートのフィルター機能を使えば、特定の顧客や緊急度でデータを絞り込めます。週次レポート前に確認すると効果的です。

### レポートの活用
週次レポートは週明けのタスク整理に最適です。「注目ポイント」を参考に、今週のフォロー優先順位を決めましょう。

---

## 次回予告（最終回）

### 第5回：キーワード監視で確度高い案件を逃さない！
**"使える営業フロー"に仕上げる最終調整**

最終回は、営業キーワード（契約/発注/検討など）を監視して確度高い案件を優先アラートします。
また、これまで作成したエージェントを統合し、実際に"使える営業フロー"として運用開始する方法を学びます。
