# 第4回：提案資料と見積書を完全自動整理！
## Drive保存 × 定期送信フローで営業資料を整流化

---

## この回の目標

「あの見積書どこにあったっけ？」「提案資料がDriveに散らばっている」という問題を解決します。**2つのエージェント**を作成し、添付ファイルの自動保存と週次レポートを実現します。

---

## Before / After

### BEFORE：受講前
- 資料探しに毎回30分かかる
- 添付ファイルがメールに埋もれる
- どこに何があるか分からない
- 資料管理は手作業で負担大

### AFTER：受講後
- 資料が即座に見つかる（95%削減）
- 添付ファイルを案件別に自動保存
- AIが自動分類・整理
- 週次で資料一覧が自動送信

---

## 作成するエージェント（2つ）

| フロー | エージェント名 | スターター |
|--------|---------------|-----------|
| フロー1 | 添付ファイル自動保存エージェント | Gmailスターター（has:attachment） |
| フロー2 | 週次資料レポートエージェント | スケジュールスターター（毎週月曜9時） |

**効果**：資料探索時間 30分/回 → 即座に検索

> **95%** 資料探索時間を削減（30分/回 → 即座に検索）

---

## 2つのフローの概要

資料管理は「保存」と「把握」の2つの課題があります。それぞれを解決するエージェントを作成します。

### フロー1：添付ファイル自動保存
**Gmailスターター（添付あり）でリアルタイム起動**

1. Gmailスターター（has:attachment）
2. Geminiステップで資料タイプ・顧客名を分類
3. Driveステップで案件フォルダに保存
4. Chat DMステップで保存完了を通知

### フロー2：週次資料レポート
**スケジュールスターター（毎週月曜9時）**

1. スケジュールスターター（毎週月曜9時）
2. Driveステップで過去7日間のファイル一覧取得
3. Geminiステップでレポート形式に整形
4. Chat DMステップで週次レポート送信

---

## 推奨フォルダ構造

効率的な資料管理のために、以下のフォルダ構造を事前にDriveで作成しておきます。

```
営業資料/
├── 株式会社A/
│   ├── Aプロジェクト/
│   │   ├── 提案書/
│   │   │   └── 2025-01-15_A社_提案書.pdf
│   │   └── 見積書/
│   │       └── 2025-01-20_A社_見積書.pdf
│   └── Bプロジェクト/
├── 株式会社B/
│   └── ...
└── 株式会社C/
    └── ...
```

### 命名規則
- **ファイル名**：日付_顧客名_資料タイプ.拡張子
- **例**：2025-01-15_A社_提案書.pdf
- **メリット**：ソートすると時系列順に並ぶ、検索しやすい

> ⚠️ **事前準備**
> 親フォルダ「営業資料」は事前にDriveで作成してください。顧客フォルダはGeminiの判定に基づいて自動作成することも可能ですが、最初は手動で主要顧客のフォルダを作成しておくことをお勧めします。

---

## フロー1：添付ファイル自動保存

### 作成手順

| Step | 内容 | 詳細 |
|------|------|------|
| 01 | Gmailスターター設定 | Gmail - Email received / Filter: has:attachment / 添付ファイル付きメールで起動 |
| 02 | Geminiステップ（分類） | 資料タイプ（提案書/見積書/契約書など）、顧客名、案件名をAIが推定 |
| 03 | Driveステップ（保存） | Drive - Upload file / Geminiが推定したフォルダパスに保存 |
| 04 | Chat DMステップ（通知） | 保存先とファイル名をChat DMで通知 / Driveへのリンクを含める（※スペース投稿は削除済） |

### 分類プロンプト

```
以下の添付ファイル付きメールを分析し、分類してください。

件名: {email_subject}
送信者: {sender}
本文: {email_body}
添付ファイル名: {attachment_names}

以下の形式で出力してください：
【資料タイプ】提案書/見積書/契約書/議事録/その他
【顧客名】推定される顧客名（メールドメインや本文から推測）
【案件名】推定される案件名（不明な場合は「一般」）
【保存フォルダ】推奨フォルダパス（例：営業資料/株式会社A/Aプロジェクト/提案書）
【ファイル名】推奨ファイル名（日付_顧客名_資料タイプ形式）

顧客名が不明な場合は、送信者のドメイン名を使用してください。
```

### 分類結果の出力例

```
【資料タイプ】見積書
【顧客名】株式会社ABC
【案件名】新システム導入プロジェクト
【保存フォルダ】営業資料/株式会社ABC/新システム導入プロジェクト/見積書
【ファイル名】2025-01-15_ABC社_見積書.pdf
```

---

## フロー2：週次資料レポート

### 作成手順

| Step | 内容 | 詳細 |
|------|------|------|
| 01 | スケジュールスターター設定 | Scheduled / 毎週月曜 9:00 AM / Asia/Tokyo |
| 02 | Driveステップ（一覧取得） | Drive - List files / 過去7日間に更新されたファイルを取得 |
| 03 | Geminiステップ（レポート） | ファイル一覧を週次レポート形式に整形 |
| 04 | Chat DMステップ（送信） | 週次レポートをChat DMで送信（※スペース投稿は削除済） |

### レポートプロンプト

```
今週の営業資料について、週次レポートを作成してください。

今週追加・更新されたファイル:
{drive_files}

以下の形式で出力してください：
📊 今週の営業資料レポート（{start_date} 〜 {end_date}）

【新規追加】
- ファイル名（顧客名）：Driveリンク

【更新】
- ファイル名（顧客名）：Driveリンク

【統計】
- 提案書: X件
- 見積書: X件
- 契約書: X件
- その他: X件

【注目案件】
今週最も動きがあった顧客TOP3

ファイルがない場合は「今週は新規・更新ファイルはありません」と出力してください。
```

### 週次レポートの出力例

```
📊 今週の営業資料レポート（1/8 〜 1/14）

【新規追加】
- 2025-01-10_ABC社_提案書.pdf（株式会社ABC）
- 2025-01-12_XYZ社_見積書.pdf（XYZ株式会社）

【更新】
- 2025-01-14_DEF社_契約書_v2.pdf（DEF株式会社）

【統計】
- 提案書: 1件
- 見積書: 1件
- 契約書: 1件
- その他: 0件

【注目案件】
1. 株式会社ABC - 提案書提出、商談フェーズ
2. DEF株式会社 - 契約書更新、最終調整中
3. XYZ株式会社 - 見積書提出、回答待ち
```

---

## Before / After 比較表

| 項目 | Before | After |
|------|--------|-------|
| 添付ファイル保存 | 手動ダウンロード → 手動アップロード | 自動でDriveに保存 |
| フォルダ整理 | バラバラに保存、後で整理 | AIが案件別に自動整理 |
| 資料探索時間 | 30分/回 | 即座に検索可能 |
| 資料状況の把握 | 何があるか分からない | 週次レポートで一覧化 |
| ファイル命名 | バラバラの命名規則 | 統一された命名規則 |

---

## 運用のコツ

### フォルダが存在しない場合の対処
Geminiが推定したフォルダが存在しない場合、エラーになることがあります。「営業資料/未分類」フォルダを作成し、不明な場合はそこに保存するようプロンプトに追記すると安定します。

### 大量の添付ファイル
メールに複数の添付ファイルがある場合、それぞれを個別に処理するループ処理が必要な場合があります。最初はシンプルに「1つ目の添付ファイルのみ」から始めることをお勧めします。

### 既存資料の整理
このエージェントは「新規メール」にのみ対応します。既存のDrive資料を整理したい場合は、別途手動で整理するか、バッチ処理用のスクリプトを作成してください。

---

## 次回予告（最終回）

### 第5回：キーワード監視で確度高い案件を逃さない！
**"使える営業フロー"に仕上げる最終調整**

最終回は、営業キーワード（契約/発注/検討など）を監視して確度高い案件を優先アラートします。
また、これまで作成した4つのエージェントを統合し、実際に"使える営業フロー"として運用開始する方法を学びます。
