# 第4回：提案資料と見積書を完全自動整理！Drive保存 × 定期送信フローで営業資料を整流化

**動画時間**: 10分
**学習目標**: メールの添付ファイルを自動でDriveに保存し、案件フォルダに整理、定期レポートを送信するエージェントを作成する

---

## 1. 導入（0:00-1:00）

### 講師セリフ

「皆さん、こんにちは。営業パイプライン自動化フロー、第4回をお届けします。

前回は、追客漏れゼロエージェントを作成し、要対応メールを自動でラベル付けする仕組みを構築しました。

今回は『営業資料自動整理エージェント』を作成します。

**（画面：散らかったDriveのイメージ）**

営業資料、どこに保存したか分からなくなること、ありませんか？

- 提案書がDriveのあちこちに散在
- 見積書がどこかに埋もれている
- 顧客から受け取った資料が見つからない

**（画面：整理されたDrive）**

このエージェントは、メールの添付ファイルを自動でDriveに保存し、案件ごとのフォルダに整理してくれます。

さらに、週次で資料一覧をレポートとして送信します。」

---

## 2. エージェントの全体像（1:00-2:00）

### 講師セリフ

「今回作るエージェントは2つのフローで構成されます。

**（画面：エージェントフロー図）**

### フロー1：添付ファイル自動保存

```
[メール受信（添付あり）] → [Gemini分類] → [Drive保存] → [Chat通知]
```

### フロー2：週次レポート

```
[毎週月曜9時] → [Drive一覧取得] → [Geminiでレポート作成] → [Chat送信]
```

**（画面：Before/After）**

| Before | After |
|--------|-------|
| 添付ファイルを手動でダウンロード | 自動でDriveに保存 |
| どこに保存したか忘れる | 案件フォルダに自動整理 |
| 資料探しに30分 | 即座に検索可能 |
| 何を受け取ったか把握困難 | 週次レポートで一覧化 |

まずは、添付ファイル自動保存のエージェントから作成しましょう。」

---

## 3. フロー1：添付ファイル自動保存（2:00-5:30）

### 講師セリフ

「新しいエージェントを作成します。

**（画面：Create → 新規エージェント）**

エージェント名は『営業資料自動整理エージェント』とします。

### 3-1. スターター設定（2:30-3:00）

**（画面：Starter選択）**

今回は『Gmail - Email received』を選択します。

**（画面：フィルター設定）**

フィルターで「添付ファイルがあるメール」を指定します：

```
has:attachment from:(@重要顧客ドメイン)
```

これで、添付ファイル付きのメールを受信したときだけ起動します。

### 3-2. Geminiで分類（3:00-4:00）

**（画面：Add Step → Gemini）**

添付ファイルの種類をGeminiに判定させます。

```
Analyze this email with attachments and classify:

Subject: {email_subject}
Body: {email_body}
Attachment names: {attachment_names}

Provide in Japanese:
【資料タイプ】提案書/見積書/契約書/議事録/その他
【顧客名】推定される顧客名
【案件名】推定される案件名
【保存フォルダ】推奨フォルダパス（例：顧客名/案件名/資料タイプ）
【ファイル名】推奨ファイル名（日付_顧客名_資料タイプ.拡張子）
```

**（画面：変数確認）**

Geminiの出力は変数 `gemini_classification` に保存します。

### 3-3. Driveに保存（4:00-5:00）

**（画面：Add Step → Google Drive）**

『Google Drive』→『Upload file』を選択します。

**（画面：Drive設定）**

- **File**: {email_attachments}
- **Folder**: 営業資料/（Geminiが判定したフォルダパス）
- **Filename**: （Geminiが提案したファイル名）

**（画面：フォルダ構造例）**

```
営業資料/
├── 株式会社A/
│   ├── Aプロジェクト/
│   │   ├── 提案書/
│   │   └── 見積書/
│   └── Bプロジェクト/
├── 株式会社B/
└── ...
```

### 3-4. Chat通知（5:00-5:30）

**（画面：Add Step → Chat）**

保存完了をChatで通知します。

```
📁 資料を自動保存しました

【送信者】{sender_name}
【ファイル名】{attachment_names}
{gemini_classification}

📂 保存先: {drive_link}
```

---

## 4. フロー2：週次レポート（5:30-8:00）

### 講師セリフ

「次に、週次レポートのフローを追加します。

**（画面：別のエージェント or 追加フロー）**

同じエージェント内に、別のスターターを追加することもできますが、今回は分かりやすく別エージェントとして作成します。

### 4-1. スターター設定（5:30-6:00）

**（画面：Create → 新規エージェント）**

エージェント名：『営業資料週次レポート』

**（画面：Starter → Scheduled）**

- **頻度**: Weekly（毎週）
- **曜日**: Monday（月曜日）
- **時刻**: 9:00 AM
- **タイムゾーン**: Asia/Tokyo

### 4-2. Driveからファイル一覧取得（6:00-6:30）

**（画面：Add Step → Google Drive）**

『Google Drive』→『List files』を選択します。

**（画面：Drive設定）**

- **Folder**: 営業資料/
- **Modified**: Last 7 days（過去7日間）
- **Include subfolders**: Yes

これで、過去1週間に追加・更新されたファイルの一覧を取得します。

### 4-3. Geminiでレポート作成（6:30-7:30）

**（画面：Add Step → Gemini）**

ファイル一覧をGeminiでレポート化します。

```
Create a weekly report of sales documents in Japanese:

{drive_files}

Format:
📊 今週の営業資料レポート（{date_range}）

【新規追加】
- ファイル名（顧客名、種類）

【更新】
- ファイル名（顧客名、種類）

【統計】
- 提案書: X件
- 見積書: X件
- 契約書: X件
- その他: X件

【注目案件】
活発な動きがある顧客TOP3
```

### 4-4. Chat送信（7:30-8:00）

**（画面：Add Step → Chat）**

レポートをChatに送信します。

```
📊 営業資料週次レポート

{gemini_report}

---
詳細はDriveをご確認ください: {drive_folder_link}
```

---

## 5. テストと有効化（8:00-9:00）

### 講師セリフ

「両方のエージェントをテストしましょう。

**（画面：テスト実行）**

### 添付ファイル自動保存のテスト

1. テスト用のメールを送信（添付ファイル付き）
2. エージェントが起動するか確認
3. Driveに正しく保存されるか確認
4. Chat通知が届くか確認

**（画面：Driveでファイル確認）**

### 週次レポートのテスト

1. Testボタンで即時実行
2. ファイル一覧が正しく取得されるか確認
3. レポートが適切に生成されるか確認
4. Chat通知が届くか確認

**（画面：テスト完了）**

問題なければ、両方のエージェントを『Enable』で有効化します。」

---

## 6. まとめ・次回予告（9:00-10:00）

### 講師セリフ

「今日は、営業資料を自動整理するエージェントを作成しました。

### 今日のポイント

**（画面：今日のポイント）**

1. **添付ファイルのトリガー**：has:attachment フィルター
2. **Geminiで分類**：資料タイプ、顧客名、案件名を推定
3. **Driveに自動保存**：構造化されたフォルダに整理
4. **週次レポート**：定期的に資料一覧をレポート
5. **Chat通知**：保存完了とレポートを通知

### Before / After

**（画面：Before/After比較）**

| 項目 | Before | After |
|------|--------|-------|
| 添付ファイル保存 | 手動ダウンロード | 自動保存 |
| フォルダ整理 | バラバラに保存 | 案件別に自動整理 |
| 資料探索時間 | 30分/回 | 即座に検索 |
| 資料把握 | 何があるか不明 | 週次レポートで一覧化 |

### 次回予告

**（画面：次回タイトル）**

次回：「キーワード監視で確度高い案件を逃さない！"使える営業フロー"に仕上げる最終調整」

最終回では、これまで作成した4つのエージェントを統合し、運用時の注意点やトラブルシューティングを学びます。

それでは、次回もお楽しみに！」

---

## 画面表示資料一覧

1. 散らかったDriveのイメージ（0:30）
2. 整理されたDrive（0:50）
3. エージェントフロー図（1:00）
4. Before/After比較（1:30）
5. Starter設定（has:attachment）（2:30）
6. Gemini分類プロンプト（3:30）
7. Drive保存設定（4:30）
8. フォルダ構造例（4:45）
9. Chat通知設定（5:15）
10. Scheduled設定（週次）（5:45）
11. Drive List files設定（6:15）
12. レポート用Geminiプロンプト（7:00）
13. テスト実行（8:00）
14. Drive確認画面（8:30）
15. 今日のポイント（9:00）
16. 次回タイトル（9:30）

---

## 講師への補足指示

- **資料管理の痛み**：「あの資料どこだっけ？」という共感ポイントを強調
- **フォルダ構造の重要性**：事前にフォルダ設計しておくことの価値を説明
- **Geminiの限界**：分類精度は100%ではないため、定期的な確認も推奨
- **2つのエージェント**：リアルタイム保存と週次レポートの2つのフローを明確に区別
- **実践的なファイル名**：日付_顧客名_資料タイプ.pdf のような命名規則を推奨
