# 動画2：Difyで作る - Dify設定完全ガイド

## Difyとは

Difyは、AIアプリケーションを視覚的に構築できるノーコード/ローコードプラットフォームです。保育日誌作成アプリを簡単に作成できます。

## アカウント作成と初期設定

### 1. アカウント作成

1. **Difyにアクセス**
   - [dify.ai](https://dify.ai) にアクセス
   - 「Get Started」または「始める」をクリック

2. **サインアップ方法を選択**
   - Googleアカウント（推奨）
   - GitHubアカウント
   - メールアドレス

3. **初期設定**
   - ワークスペース名：「〇〇保育園」など
   - 言語設定：日本語
   - タイムゾーン：Asia/Tokyo

### 2. APIキーの設定

#### OpenAI APIキーの取得
1. [platform.openai.com](https://platform.openai.com) にアクセス
2. API Keys → Create new secret key
3. キーをコピー（一度しか表示されません）

#### DifyにAPIキーを登録
1. Settings（設定）→ Model Provider（モデルプロバイダー）
2. OpenAIを選択
3. APIキーを貼り付け
4. 「Save」をクリック

## 保育日誌アプリの作成手順

### Step 1: 新規アプリ作成

1. **アプリタイプの選択**
   ```
   ダッシュボード → 「Create Application」
   → 「Create from Blank」を選択
   → 「Chat App」を選択
   ```

2. **基本情報の入力**
   - アプリ名：「保育日誌作成アシスタント」
   - アイコン：📝（絵文字から選択）
   - 説明：「簡単な入力から保育日誌を自動生成」

### Step 2: プロンプト設定

1. **Instructions（指示）タブ**
   ```
   あなたは保育園の日誌作成を支援するアシスタントです。
   
   入力された活動内容をもとに、以下の形式で日誌を作成してください：
   
   【今日の活動】
   活動内容を具体的に記載し、子どもたちの反応を含めます。
   
   【子どもの様子】
   個別の観察記録を含め、成長や変化を具体的に記載します。
   
   【明日への連携】
   継続観察ポイントや次の活動への展開を記載します。
   
   文体は温かく、保護者が読んで安心する表現を使用してください。
   個人名はイニシャルで表記してください。
   ```

2. **Variables（変数）設定**
   
   | 変数名 | ラベル | タイプ | 必須 | デフォルト値 |
   |--------|--------|--------|------|--------------|
   | date | 日付 | Text | No | 今日 |
   | activity | 活動内容 | Paragraph | Yes | - |
   | observation | 個別観察 | Paragraph | No | - |
   | weather | 天気 | Select | No | 晴れ |

### Step 3: モデル設定

1. **Model（モデル）タブ**
   - Provider: OpenAI
   - Model: gpt-3.5-turbo（コスト重視）
   - または gpt-4（品質重視）

2. **パラメータ設定**
   ```
   Temperature: 0.7（創造性と一貫性のバランス）
   Max Tokens: 500（適切な長さ）
   Top P: 0.9
   Frequency Penalty: 0.3（繰り返しを減らす）
   ```

### Step 4: フォーム設計

1. **User Input Form（入力フォーム）**
   ```yaml
   フィールド1:
     名前: 日付
     タイプ: Date Picker
     必須: No
   
   フィールド2:
     名前: 活動内容
     タイプ: Text Area
     プレースホルダー: "例：園庭で砂遊び、ブロック遊びなど"
     必須: Yes
   
   フィールド3:
     名前: 個別観察
     タイプ: Text Area
     プレースホルダー: "例：Aちゃんは初めて一人で靴を履けた"
     必須: No
   
   フィールド4:
     名前: 天気
     タイプ: Dropdown
     選択肢: [晴れ, 曇り, 雨, 雪]
     必須: No
   ```

### Step 5: 応答設定

1. **Opening Statement（開始メッセージ）**
   ```
   こんにちは！保育日誌作成をお手伝いします。
   今日の活動内容を教えてください。
   簡単なメモで大丈夫です！
   ```

2. **Suggested Questions（サンプル質問）**
   - 「今日は園庭で泥遊びをしました」
   - 「製作活動でみんな集中していました」
   - 「給食を完食した子が多かったです」

## 高度な設定

### Knowledge Base（知識ベース）の追加

1. **保育用語辞書の登録**
   ```
   Settings → Knowledge → Upload
   保育用語集.txt をアップロード
   ```

2. **過去の日誌サンプル**
   ```
   優良な日誌例を学習データとして追加
   ```

### Workflow（ワークフロー）モード

より複雑な処理が必要な場合：

1. **ワークフローの作成**
   ```
   1. 入力受付 → 2. 内容分類 → 3. 日誌生成 → 4. 品質チェック → 5. 出力
   ```

2. **条件分岐の設定**
   - 活動タイプによって異なるテンプレート
   - 年齢別の表現調整

### API公開設定

他のシステムと連携する場合：

1. **API Access**
   ```
   Settings → API Access → Generate API Key
   ```

2. **エンドポイント**
   ```
   POST https://api.dify.ai/v1/chat/completions
   Headers: 
     Authorization: Bearer YOUR_API_KEY
     Content-Type: application/json
   ```

## テストとデバッグ

### 1. プレビューモード

1. 右上の「Preview」ボタンをクリック
2. テスト入力を実行
3. 出力を確認

### 2. テストケース

**テスト1：基本入力**
```
入力：外遊び。みんな元気。
期待：適切にフォーマットされた日誌
```

**テスト2：詳細入力**
```
入力：
午前：リトミック、Bちゃん初参加
午後：お昼寝、Cくんなかなか寝付けず
期待：個別観察が含まれた詳細な日誌
```

### 3. ログ確認

1. Logs タブで実行履歴を確認
2. エラーメッセージをチェック
3. トークン使用量を監視

## 運用のベストプラクティス

### 1. コスト管理

- **使用量モニタリング**
  ```
  Settings → Usage → 日次/月次レポート確認
  ```

- **コスト削減策**
  - GPT-3.5を基本とする
  - Max Tokensを適切に設定
  - キャッシュを活用

### 2. セキュリティ

- **アクセス制御**
  - チームメンバーの権限設定
  - APIキーの定期更新

- **データ保護**
  - 個人情報のマスキング
  - ログの定期削除

### 3. 継続的改善

- **フィードバック収集**
  - 利用者アンケート
  - 出力品質の評価

- **プロンプト最適化**
  - A/Bテスト実施
  - 定期的な見直し

## トラブルシューティング

### よくある問題と解決策

| 問題 | 原因 | 解決策 |
|------|------|--------|
| 応答が遅い | モデルの混雑 | GPT-3.5に切り替え |
| 出力が不自然 | Temperature高すぎ | 0.5-0.7に調整 |
| コストが高い | トークン使いすぎ | Max Tokens削減 |
| エラー頻発 | APIキー問題 | キーを再確認 |

## 次のステップ

動画3では、このアプリのプロンプトを最適化し、より高品質な日誌を生成する方法を学びます。