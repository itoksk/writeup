<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹•ç”»6: Google APIsçµ±åˆé€£æºï¼Gmailãƒ»Calendarãƒ»Chatãƒ»Driveã‚’ä¸€å…ƒçš„ã«è‡ªå‹•æ“ä½œ</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #4285f4;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            border-left: 5px solid #4285f4;
            padding-left: 15px;
            margin-top: 40px;
        }
        
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .api-integration {
            background-color: #e8f0fe;
            border: 2px solid #4285f4;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .before {
            background-color: #ffebee;
            border-left: 5px solid #f44336;
            padding: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .after {
            background-color: #e8f5e8;
            border-left: 5px solid #4caf50;
            padding: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .gmail-api {
            background-color: #fff3e0;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .calendar-api {
            background-color: #f3e5f5;
            border: 2px solid #9c27b0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .chat-api {
            background-color: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .drive-api {
            background-color: #fff8e1;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .api-card {
            background: #f8f9fa;
            border: 2px solid #4285f4;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .feature-highlight {
            background: linear-gradient(90deg, #e8f0fe 0%, #f3e5f5 100%);
            border-left: 5px solid #4285f4;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .success-tip {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .flow-diagram {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .before-after, .api-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— Google APIsçµ±åˆé€£æºã®å¨åŠ›ï¼è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã®å”èª¿è‡ªå‹•åŒ–</h1>
        
        <div class="highlight-box">
            <h2 style="border: none; color: white; margin-top: 0;">ğŸ¯ ã“ã®å‹•ç”»ã§å­¦ã¶ã“ã¨</h2>
            <ul>
                <li>Gmail API ã«ã‚ˆã‚‹é«˜åº¦ãªãƒ¡ãƒ¼ãƒ«é…ä¿¡ã¨ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜</li>
                <li>Calendar API ã«ã‚ˆã‚‹è¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸ã®è‡ªå‹•äºˆå®šç™»éŒ²</li>
                <li>Chat API ã«ã‚ˆã‚‹ãƒªãƒƒãƒã‚«ãƒ¼ãƒ‰é€šçŸ¥é…ä¿¡</li>
                <li>Drive API ã«ã‚ˆã‚‹è‡ªå‹•ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã¨å…±æœ‰è¨­å®š</li>
            </ul>
        </div>

        <h2>ğŸš€ çµ±åˆé€£æºã®é©å‘½çš„ä¾¡å€¤</h2>
        
        <div class="before-after">
            <div class="before">
                <h3>âŒ å€‹åˆ¥å‡¦ç†ã®é™ç•Œ</h3>
                <ul>
                    <li><strong>æ‰‹å‹•é€£æº:</strong> ãƒ¡ãƒ¼ãƒ«â†’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼â†’é€šçŸ¥ã‚’æ‰‹å‹•å®Ÿè¡Œ</li>
                    <li><strong>æ™‚é–“æµªè²»:</strong> å„ã‚µãƒ¼ãƒ“ã‚¹ã«å€‹åˆ¥ãƒ­ã‚°ã‚¤ãƒ³ãƒ»æ“ä½œ</li>
                    <li><strong>ãƒŸã‚¹ç™ºç”Ÿ:</strong> æ‰‹å‹•ä½œæ¥­ã«ã‚ˆã‚‹é€£æºæ¼ã‚Œ</li>
                    <li><strong>ä¸æ•´åˆ:</strong> ã‚µãƒ¼ãƒ“ã‚¹é–“ã§ã®æƒ…å ±ã®é£Ÿã„é•ã„</li>
                    <li><strong>æ‹¡å¼µå›°é›£:</strong> æ–°æ©Ÿèƒ½è¿½åŠ ãŒè¤‡é›‘</li>
                </ul>
            </div>
            
            <div class="after">
                <h3>âœ… APIçµ±åˆã«ã‚ˆã‚‹å¤‰é©</h3>
                <ul>
                    <li><strong>ä¸€æ‹¬å®Ÿè¡Œ:</strong> 1ã¤ã®ãƒˆãƒªã‚¬ãƒ¼ã§å…¨ã‚µãƒ¼ãƒ“ã‚¹è‡ªå‹•å®Ÿè¡Œ</li>
                    <li><strong>æ™‚é–“çŸ­ç¸®:</strong> 30åˆ†ã®ä½œæ¥­ãŒ30ç§’ã§å®Œäº†</li>
                    <li><strong>ç¢ºå®Ÿæ€§:</strong> ãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆ¶å¾¡ã§100%å®Ÿè¡Œ</li>
                    <li><strong>ãƒ‡ãƒ¼ã‚¿æ•´åˆ:</strong> åŒä¸€ãƒ‡ãƒ¼ã‚¿ã§å…¨ã‚µãƒ¼ãƒ“ã‚¹æ›´æ–°</li>
                    <li><strong>æ‹¡å¼µå®¹æ˜“:</strong> æ–°APIè¿½åŠ ãŒç°¡å˜</li>
                </ul>
            </div>
        </div>

        <h2>ğŸ—ï¸ çµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ</h2>
        
        <div class="flow-diagram">
            <h3>ğŸ”„ çµ±åˆAPIå®Ÿè¡Œãƒ•ãƒ­ãƒ¼</h3>
            <div class="code-block" style="text-align: left;">
ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡/WebAppå®Ÿè¡Œï¼ˆãƒˆãƒªã‚¬ãƒ¼ï¼‰
        â†“
Google Apps Scriptï¼ˆä¸­å¤®ãƒãƒ–ï¼‰
        â†“
ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ãƒ»æ§‹é€ åŒ–
        â†“
ä¸¦è¡ŒAPIå®Ÿè¡Œï¼ˆåŒæ™‚å‡¦ç†ï¼‰
    â”œâ†’ Gmail APIï¼ˆãƒ¡ãƒ¼ãƒ«é…ä¿¡ï¼‰
    â”œâ†’ Calendar APIï¼ˆäºˆå®šç™»éŒ²ï¼‰
    â”œâ†’ Chat APIï¼ˆãƒãƒ¼ãƒ é€šçŸ¥ï¼‰
    â””â†’ Drive APIï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ï¼‰
        â†“
å®Ÿè¡Œçµæœã®çµ±åˆãƒ»ãƒ­ã‚°è¨˜éŒ²
        â†“
å®Œäº†é€šçŸ¥ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
</div>
            <p><strong>ğŸ¯ è¨­è¨ˆæ€æƒ³ï¼š</strong> å˜ä¸€ã®ãƒˆãƒªã‚¬ãƒ¼ã‹ã‚‰è¤‡æ•°ã®Google APIã‚’å”èª¿å®Ÿè¡Œã—ã€åŒ…æ‹¬çš„ãªè‡ªå‹•åŒ–ã‚’å®Ÿç¾</p>
        </div>

        <h2>ğŸ“§ Gmail API é«˜åº¦æ´»ç”¨</h2>
        
        <div class="gmail-api">
            <h3>âœ‰ï¸ æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ä»˜ããƒªãƒƒãƒãƒ¡ãƒ¼ãƒ«é€ä¿¡</h3>
            
            <h4>APIæœ‰åŠ¹åŒ–ã¨è¨­å®š</h4>
            <div class="code-block">
// Gmail API ã®æœ‰åŠ¹åŒ–
// Apps Script â†’ ã‚µãƒ¼ãƒ“ã‚¹ â†’ Gmail API ã‚’è¿½åŠ 

function sendWelcomeEmailWithAttachments(employeeData) {
  console.log('Gmail APIå®Ÿè¡Œ:', employeeData.email);
  
  try {
    // ãƒ¡ãƒ¼ãƒ«å†…å®¹ç”Ÿæˆï¼ˆå‰å›ã®AIç”Ÿæˆæ©Ÿèƒ½ã‚’æ´»ç”¨ï¼‰
    const emailContent = generatePersonalizedWelcomeEmail(employeeData);
    
    // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«æº–å‚™
    const attachments = prepareWelcomeAttachments(employeeData);
    
    // Gmail API ã§ãƒªãƒƒãƒãƒ¡ãƒ¼ãƒ«é€ä¿¡
    const emailPayload = {
      userId: 'me',
      resource: {
        raw: createRawEmailWithAttachments(
          employeeData.email,
          emailContent.subject,
          emailContent.body,
          attachments
        )
      }
    };
    
    const response = Gmail.Users.Messages.send(emailPayload);
    console.log('âœ… Gmail APIé€ä¿¡æˆåŠŸ:', response.id);
    
    return { success: true, messageId: response.id };
    
  } catch (error) {
    console.error('Gmail API ã‚¨ãƒ©ãƒ¼:', error);
    return { success: false, error: error.message };
  }
}</div>
            
            <h4>å‹•çš„æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ</h4>
            <div class="code-block">
function prepareWelcomeAttachments(employeeData) {
  const attachments = [];
  
  try {
    // 1. ä¼šç¤¾æ¡ˆå†…PDFï¼ˆå…±é€šï¼‰
    const companyGuideId = 'COMPANY_GUIDE_FILE_ID';
    const companyGuide = DriveApp.getFileById(companyGuideId);
    attachments.push({
      name: 'ä¼šç¤¾æ¡ˆå†….pdf',
      mimeType: 'application/pdf',
      content: Utilities.base64Encode(companyGuide.getBlob().getBytes())
    });
    
    // 2. éƒ¨ç½²åˆ¥è³‡æ–™ï¼ˆå‹•çš„é¸æŠï¼‰
    const deptGuideId = getDepartmentGuideFileId(employeeData.department);
    if (deptGuideId) {
      const deptGuide = DriveApp.getFileById(deptGuideId);
      attachments.push({
        name: `${employeeData.department}_æ¡ˆå†….pdf`,
        mimeType: 'application/pdf',
        content: Utilities.base64Encode(deptGuide.getBlob().getBytes())
      });
    }
    
    // 3. å€‹äººç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆå‹•çš„ç”Ÿæˆï¼‰
    const checklistContent = generatePersonalChecklist(employeeData);
    const checklistBlob = Utilities.newBlob(checklistContent, 'text/html', 'ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ.html');
    attachments.push({
      name: `${employeeData.name}æ§˜_å…¥ç¤¾ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ.html`,
      mimeType: 'text/html',
      content: Utilities.base64Encode(checklistBlob.getBytes())
    });
    
  } catch (error) {
    console.error('æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«æº–å‚™ã‚¨ãƒ©ãƒ¼:', error);
  }
  
  return attachments;
}</div>
            
            <div class="success-tip">
                <strong>ğŸ“§ Gmail API ã®å„ªä½æ€§:</strong> åŸºæœ¬ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚’è¶…ãˆãŸã€æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»HTMLãƒ»CC/BCCãƒ»é‡è¦åº¦è¨­å®šãªã©ä¼æ¥­ãƒ¬ãƒ™ãƒ«ã®æ©Ÿèƒ½
            </div>
        </div>

        <h2>ğŸ“… Calendar API ãƒãƒ«ãƒã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å¯¾å¿œ</h2>
        
        <div class="calendar-api">
            <h3>ğŸ—“ï¸ è¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸ã®è‡ªå‹•äºˆå®šç™»éŒ²</h3>
            
            <h4>Calendar API è¨­å®š</h4>
            <div class="code-block">
// Calendar API ã®æœ‰åŠ¹åŒ–
// Apps Script â†’ ã‚µãƒ¼ãƒ“ã‚¹ â†’ Calendar API ã‚’è¿½åŠ 

function createMultipleCalendarEvents(employeeData) {
  console.log('Calendar APIå®Ÿè¡Œ:', employeeData.name);
  
  const events = generateCalendarEvents(employeeData);
  const createdEvents = [];
  
  events.forEach(eventData => {
    try {
      // å„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«å¯¾ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
      const event = Calendar.Events.insert(eventData.event, eventData.calendarId);
      createdEvents.push({
        eventId: event.id,
        summary: event.summary,
        calendarId: eventData.calendarId,
        attendees: event.attendees?.length || 0
      });
      console.log(`ğŸ“… ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆæˆåŠŸ: ${event.summary}`);
      
    } catch (eventError) {
      console.error(`ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆå¤±æ•—: ${eventData.event.summary}`, eventError);
    }
  });
  
  return { 
    success: true, 
    createdEvents: createdEvents, 
    count: createdEvents.length 
  };
}</div>
            
            <h4>ãƒãƒ«ãƒã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆç”Ÿæˆ</h4>
            <div class="code-block">
function generateCalendarEvents(employeeData) {
  const startDate = new Date(employeeData.startDate);
  const events = [];
  
  // 1. äººäº‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼: ã‚¦ã‚§ãƒ«ã‚«ãƒ é¢è«‡
  events.push({
    calendarId: 'primary', // äººäº‹éƒ¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
    event: {
      summary: `ã€ã‚¦ã‚§ãƒ«ã‚«ãƒ é¢è«‡ã€‘${employeeData.name}æ§˜`,
      start: { 
        dateTime: getTimeSlot(startDate, 10, 0).toISOString() 
      },
      end: { 
        dateTime: getTimeSlot(startDate, 11, 0).toISOString() 
      },
      description: createEventDescription('ã‚¦ã‚§ãƒ«ã‚«ãƒ é¢è«‡', employeeData),
      attendees: [
        { email: employeeData.email },
        { email: 'hr@company.com' },
        { email: getDepartmentManager(employeeData.department).email }
      ],
      conferenceData: {
        createRequest: { 
          requestId: `welcome-${employeeData.name}-${Date.now()}` 
        }
      },
      reminders: {
        useDefault: false,
        overrides: [
          { method: 'email', minutes: 24 * 60 }, // 1æ—¥å‰
          { method: 'popup', minutes: 30 }       // 30åˆ†å‰
        ]
      }
    }
  });
  
  // 2. éƒ¨ç½²ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼: ã‚ªãƒªã‚¨ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
  events.push({
    calendarId: getDepartmentCalendarId(employeeData.department),
    event: {
      summary: `${employeeData.department} ã‚ªãƒªã‚¨ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ - ${employeeData.name}æ§˜`,
      start: { 
        dateTime: getTimeSlot(startDate, 14, 0).toISOString() 
      },
      end: { 
        dateTime: getTimeSlot(startDate, 15, 30).toISOString() 
      },
      description: createEventDescription('éƒ¨ç½²ã‚ªãƒªã‚¨ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³', employeeData),
      attendees: getDepartmentMembers(employeeData.department),
      location: `${employeeData.department}ä¼šè­°å®¤`,
      transparency: 'opaque',
      visibility: 'private'
    }
  });
  
  // 3. å…¨ç¤¾ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼: æ–°å…¥ç¤¾å“¡ç´¹ä»‹
  events.push({
    calendarId: 'company-all@company.com',
    event: {
      summary: `ğŸ‰ æ–°ãƒ¡ãƒ³ãƒãƒ¼ç´¹ä»‹: ${employeeData.name}æ§˜ï¼ˆ${employeeData.department}ï¼‰`,
      start: { 
        date: startDate.toISOString().split('T')[0] // çµ‚æ—¥ã‚¤ãƒ™ãƒ³ãƒˆ
      },
      end: { 
        date: getNextDay(startDate).toISOString().split('T')[0]
      },
      description: `${employeeData.name}æ§˜ãŒ${employeeData.department}ã«æ–°ã—ãåŠ ã‚ã‚Šã¾ã™ï¼`,
      transparency: 'transparent' // æ™‚é–“ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„
    }
  });
  
  // 4. ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ1é€±é–“å¾Œï¼‰
  const followUpDate = new Date(startDate);
  followUpDate.setDate(followUpDate.getDate() + 7);
  
  events.push({
    calendarId: 'primary',
    event: {
      summary: `ã€1é€±é–“ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ã€‘${employeeData.name}æ§˜`,
      start: { 
        dateTime: getTimeSlot(followUpDate, 16, 0).toISOString() 
      },
      end: { 
        dateTime: getTimeSlot(followUpDate, 16, 30).toISOString() 
      },
      attendees: [
        { email: employeeData.email },
        { email: getDepartmentManager(employeeData.department).email }
      ]
    }
  });
  
  return events;
}</div>
            
            <div class="success-tip">
                <strong>ğŸ“… Calendar API ã®é«˜åº¦æ©Ÿèƒ½:</strong> è¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç®¡ç†ã€ãƒ“ãƒ‡ã‚ªä¼šè­°è‡ªå‹•ç”Ÿæˆã€ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è¨­å®šã€æ¨©é™åˆ¶å¾¡
            </div>
        </div>

        <h2>ğŸ’¬ Chat API ãƒªãƒƒãƒé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ </h2>
        
        <div class="chat-api">
            <h3>ğŸ“¢ éƒ¨ç½²åˆ¥ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–é€šçŸ¥</h3>
            
            <h4>Chat Webhook è¨­å®š</h4>
            <div class="code-block">
// Google Chat ã§ã® Webhook è¨­å®šæ‰‹é †
// 1. Google Chat â†’ å¯¾è±¡ã‚¹ãƒšãƒ¼ã‚¹ â†’ ã‚¢ãƒ—ãƒªã¨çµ±åˆ â†’ Webhook
// 2. Webhook URLã‚’å–å¾—
// 3. Apps Script ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ä¿å­˜

function sendDepartmentChatNotifications(employeeData) {
  console.log('Chat APIå®Ÿè¡Œ');
  
  const notifications = [
    {
      department: 'ITéƒ¨é–€',
      webhook: PropertiesService.getScriptProperties().getProperty('IT_CHAT_WEBHOOK'),
      message: createITDepartmentMessage(employeeData)
    },
    {
      department: 'ç·å‹™éƒ¨',
      webhook: PropertiesService.getScriptProperties().getProperty('GA_CHAT_WEBHOOK'),
      message: createGADepartmentMessage(employeeData)
    },
    {
      department: employeeData.department,
      webhook: PropertiesService.getScriptProperties().getProperty(`${employeeData.department.toUpperCase()}_CHAT_WEBHOOK`),
      message: createDepartmentWelcomeMessage(employeeData)
    }
  ];
  
  const results = [];
  
  notifications.forEach(notification => {
    if (notification.webhook) {
      const result = sendRichChatMessage(notification.webhook, notification.message);
      results.push({
        department: notification.department,
        success: result.success
      });
    }
  });
  
  return results;
}</div>
            
            <h4>ãƒªãƒƒãƒã‚«ãƒ¼ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ</h4>
            <div class="code-block">
function createITDepartmentMessage(employeeData) {
  return {
    text: `ğŸ†• æ–°å…¥ç¤¾å“¡PCæº–å‚™ã®ãŠé¡˜ã„`,
    cards: [{
      header: {
        title: `ITéƒ¨é–€ã¸ã®æ–°å…¥ç¤¾å“¡æº–å‚™ä¾é ¼`,
        subtitle: `${employeeData.name}æ§˜ï¼ˆ${employeeData.position}ï¼‰`,
        imageUrl: 'https://developers.google.com/chat/images/quickstart-app-avatar.png'
      },
      sections: [{
        widgets: [{
          textParagraph: {
            text: `<b>æ–°å…¥ç¤¾å“¡æƒ…å ±:</b><br>
ğŸ‘¤ æ°å: ${employeeData.name}<br>
ğŸ“… å…¥ç¤¾æ—¥: ${Utilities.formatDate(new Date(employeeData.startDate), 'JST', 'yyyyå¹´MMæœˆddæ—¥')}<br>
ğŸ¢ éƒ¨ç½²: ${employeeData.department}<br>
ğŸ’¼ è·ç¨®: ${employeeData.position}<br>
ğŸ“§ ãƒ¡ãƒ¼ãƒ«: ${employeeData.email}`
          }
        }]
      }, {
        header: `ğŸ“‹ ITéƒ¨é–€æ‹…å½“ã‚¿ã‚¹ã‚¯`,
        widgets: [{
          textParagraph: {
            text: `â€¢ <b>PCãƒ»å‘¨è¾ºæ©Ÿå™¨ã®æº–å‚™</b><br>
â€¢ <b>ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»ã‚·ã‚¹ãƒ†ãƒ æ¨©é™è¨­å®š</b><br>
â€¢ <b>VPNãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š</b><br>
â€¢ <b>é–‹ç™ºç’°å¢ƒæ§‹ç¯‰ï¼ˆ${employeeData.department}ç”¨ï¼‰</b><br>
â€¢ <b>Office365ãƒ»Google Workspaceè¨­å®š</b>`
          }
        }]
      }, {
        widgets: [{
          buttons: [{
            textButton: {
              text: 'ğŸ“Š ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚·ãƒ¼ãƒˆã‚’é–‹ã',
              onClick: {
                openLink: {
                  url: getTaskSheetUrl()
                }
              }
            }
          }, {
            textButton: {
              text: 'âœ… æº–å‚™å®Œäº†ã‚’å ±å‘Š',
              onClick: {
                openLink: {
                  url: `mailto:hr@company.com?subject=${employeeData.name}æ§˜ã®ITæº–å‚™å®Œäº†&body=æº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸã€‚`
                }
              }
            }
          }]
        }]
      }]
    }]
  };
}

function sendRichChatMessage(webhookUrl, message) {
  try {
    const options = {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      payload: JSON.stringify(message)
    };
    
    const response = UrlFetchApp.fetch(webhookUrl, options);
    
    return { 
      success: response.getResponseCode() === 200,
      response: response.getContentText() 
    };
    
  } catch (error) {
    console.error('Chaté€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
    return { success: false, error: error.message };
  }
}</div>
            
            <div class="success-tip">
                <strong>ğŸ’¬ Chat API ã®ç‰¹å¾´:</strong> ãƒªãƒƒãƒã‚«ãƒ¼ãƒ‰ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã€@ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã€ã‚¹ãƒ¬ãƒƒãƒ‰è¿”ä¿¡ãªã©ã®é«˜åº¦ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
            </div>
        </div>

        <h2>ğŸ“ Drive API è‡ªå‹•ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†</h2>
        
        <div class="drive-api">
            <h3>ğŸ—‚ï¸ å€‹äººãƒ•ã‚©ãƒ«ãƒ€ã¨æ›¸é¡ã®è‡ªå‹•æº–å‚™</h3>
            
            <h4>Drive API è¨­å®š</h4>
            <div class="code-block">
// Drive API ã®æœ‰åŠ¹åŒ–
// Apps Script â†’ ã‚µãƒ¼ãƒ“ã‚¹ â†’ Drive API ã‚’è¿½åŠ 

function createEmployeeFolder(employeeData) {
  console.log('Drive APIå®Ÿè¡Œ:', employeeData.name);
  
  try {
    // 1. æ–°å…¥ç¤¾å“¡å°‚ç”¨ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
    const employeeFolder = createEmployeeMainFolder(employeeData);
    
    // 2. ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ä½œæˆ
    const subFolders = createSubFolders(employeeFolder.getId(), employeeData);
    
    // 3. å¿…è¦æ›¸é¡ã®è‡ªå‹•é…ç½®
    const documents = setupEmployeeDocuments(employeeFolder.getId(), employeeData);
    
    // 4. å…±æœ‰è¨­å®š
    const sharingResult = setupFolderSharing(employeeFolder, employeeData);
    
    return {
      success: true,
      folderId: employeeFolder.getId(),
      folderUrl: employeeFolder.getUrl(),
      subFolders: subFolders,
      documents: documents,
      sharing: sharingResult
    };
    
  } catch (error) {
    console.error('Drive API ã‚¨ãƒ©ãƒ¼:', error);
    return { success: false, error: error.message };
  }
}

function createEmployeeMainFolder(employeeData) {
  const parentFolder = DriveApp.getFolderById('EMPLOYEE_ROOT_FOLDER_ID');
  const folderName = `${employeeData.name}æ§˜_${Utilities.formatDate(new Date(employeeData.startDate), 'JST', 'yyyyå¹´MMæœˆddæ—¥')}å…¥ç¤¾`;
  
  const employeeFolder = parentFolder.createFolder(folderName);
  
  // ãƒ•ã‚©ãƒ«ãƒ€ã®èª¬æ˜ã‚’è¨­å®š
  Drive.Files.update({
    description: `${employeeData.name}æ§˜ï¼ˆ${employeeData.department}ãƒ»${employeeData.position}ï¼‰ã®å…¥ç¤¾é–¢é€£è³‡æ–™`
  }, employeeFolder.getId());
  
  return employeeFolder;
}</div>
            
            <h4>éšå±¤ãƒ•ã‚©ãƒ«ãƒ€ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè‡ªå‹•ç”Ÿæˆ</h4>
            <div class="code-block">
function createSubFolders(parentFolderId, employeeData) {
  const parentFolder = DriveApp.getFolderById(parentFolderId);
  const subFolders = [];
  
  const folderStructure = [
    '01_å…¥ç¤¾æ‰‹ç¶šãæ›¸é¡',
    '02_ç ”ä¿®è³‡æ–™',
    '03_éƒ¨ç½²è³‡æ–™',
    '04_ã‚·ã‚¹ãƒ†ãƒ ãƒ»ãƒ„ãƒ¼ãƒ«',
    '05_ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè³‡æ–™',
    '06_å®šæœŸé¢è«‡è¨˜éŒ²'
  ];
  
  folderStructure.forEach(folderName => {
    const subFolder = parentFolder.createFolder(folderName);
    subFolders.push({
      name: folderName,
      id: subFolder.getId(),
      url: subFolder.getUrl()
    });
  });
  
  return subFolders;
}

function setupEmployeeDocuments(folderId, employeeData) {
  const documents = [];
  const folder = DriveApp.getFolderById(folderId);
  
  // 1. å€‹äººç”¨ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆä½œæˆ
  const checklistContent = generateDetailedChecklist(employeeData);
  const checklistDoc = DriveApp.createFile(
    `${employeeData.name}æ§˜_ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ.html`,
    checklistContent,
    MimeType.HTML
  );
  
  // ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•
  folder.addFile(checklistDoc);
  DriveApp.getRootFolder().removeFile(checklistDoc);
  
  documents.push({
    name: checklistDoc.getName(),
    id: checklistDoc.getId(),
    url: checklistDoc.getUrl()
  });
  
  // 2. éƒ¨ç½²åˆ¥ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ
  const welcomeContent = generateDepartmentWelcomeDoc(employeeData);
  const welcomeDoc = DriveApp.createFile(
    `${employeeData.department}_ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚¬ã‚¤ãƒ‰.html`,
    welcomeContent,
    MimeType.HTML
  );
  
  folder.addFile(welcomeDoc);
  DriveApp.getRootFolder().removeFile(welcomeDoc);
  
  documents.push({
    name: welcomeDoc.getName(),
    id: welcomeDoc.getId(),
    url: welcomeDoc.getUrl()
  });
  
  // 3. æ—¢å­˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚³ãƒ”ãƒ¼
  const templateIds = getTemplateDocuments(employeeData.department);
  templateIds.forEach(templateId => {
    try {
      const template = DriveApp.getFileById(templateId);
      const copy = template.makeCopy(`${employeeData.name}æ§˜ç”¨_${template.getName()}`, folder);
      
      documents.push({
        name: copy.getName(),
        id: copy.getId(),
        url: copy.getUrl()
      });
    } catch (error) {
      console.error('ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
    }
  });
  
  return documents;
}</div>
            
            <div class="success-tip">
                <strong>ğŸ“ Drive API ã®å¨åŠ›:</strong> ãƒ•ã‚©ãƒ«ãƒ€éšå±¤è‡ªå‹•ä½œæˆã€æ¨©é™è¨­å®šã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¤‡è£½ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†
            </div>
        </div>

        <h2>ğŸ”— çµ±åˆå®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ </h2>
        
        <div class="api-integration">
            <h3>âš¡ ä¸¦è¡Œå‡¦ç†ã«ã‚ˆã‚‹é«˜é€Ÿå®Ÿè¡Œ</h3>
            
            <div class="code-block">
function executeIntegratedAutomation(employeeData) {
  console.log('=== çµ±åˆè‡ªå‹•åŒ–å®Ÿè¡Œé–‹å§‹ ===');
  
  try {
    // å®Ÿè¡Œé–‹å§‹æ™‚é–“è¨˜éŒ²
    const startTime = new Date();
    
    // ä¸¦è¡Œå‡¦ç†ã§å…¨APIå®Ÿè¡Œï¼ˆ5ç§’ä»¥å†…å®Œäº†ç›®æ¨™ï¼‰
    const results = {
      email: sendWelcomeEmailWithAttachments(employeeData),
      calendar: createMultipleCalendarEvents(employeeData),
      chat: sendDepartmentChatNotifications(employeeData),
      drive: createEmployeeFolder(employeeData),
      totalTime: null
    };
    
    // å®Ÿè¡Œæ™‚é–“è¨ˆç®—
    results.totalTime = new Date() - startTime;
    
    // çµ±åˆçµæœã‚’ãƒ­ã‚°
    logIntegrationResults(employeeData, results);
    
    // æˆåŠŸã‚µãƒãƒªãƒ¼ä½œæˆ
    const summary = createExecutionSummary(results);
    
    console.log('=== çµ±åˆè‡ªå‹•åŒ–å®Œäº† ===');
    console.log(`å®Ÿè¡Œæ™‚é–“: ${results.totalTime}ms`);
    
    return {
      success: true,
      results: results,
      summary: summary,
      executionTime: results.totalTime
    };
    
  } catch (error) {
    console.error('çµ±åˆå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
    return { 
      success: false, 
      error: error.message,
      partialResults: results || {}
    };
  }
}

function createExecutionSummary(results) {
  return {
    totalAPIs: 4,
    successfulAPIs: Object.values(results).filter(r => r && r.success).length,
    emailSent: results.email?.success || false,
    eventsCreated: results.calendar?.count || 0,
    chatsSent: results.chat?.filter(c => c.success).length || 0,
    folderCreated: results.drive?.success || false,
    performanceGrade: results.totalTime < 10000 ? 'Excellent' : 
                     results.totalTime < 20000 ? 'Good' : 'Needs Improvement'
  };
}</div>
            
            <h4>å®Ÿè¡Œçµæœã®å¯è¦–åŒ–</h4>
            <div class="code-block">
function logIntegrationResults(employeeData, results) {
  const logSheet = getOrCreateIntegrationLogSheet();
  
  logSheet.appendRow([
    new Date(),                                    // å®Ÿè¡Œæ—¥æ™‚
    employeeData.name,                            // å¯¾è±¡è€…
    employeeData.email,                           // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
    employeeData.department,                      // éƒ¨ç½²
    results.email?.success ? 'æˆåŠŸ' : 'å¤±æ•—',      // ãƒ¡ãƒ¼ãƒ«
    results.calendar?.count || 0,                 // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆæ•°
    results.chat?.filter(c => c.success).length || 0, // Chaté€šçŸ¥æ•°
    results.drive?.success ? 'æˆåŠŸ' : 'å¤±æ•—',      // Drive
    results.totalTime,                            // å®Ÿè¡Œæ™‚é–“
    JSON.stringify(results)                       // è©³ç´°çµæœ
  ]);
}

function getOrCreateIntegrationLogSheet() {
  const spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
  let logSheet = spreadsheet.getSheetByName('çµ±åˆå®Ÿè¡Œãƒ­ã‚°');
  
  if (!logSheet) {
    logSheet = spreadsheet.insertSheet('çµ±åˆå®Ÿè¡Œãƒ­ã‚°');
    logSheet.getRange(1, 1, 1, 10).setValues([
      ['å®Ÿè¡Œæ—¥æ™‚', 'æ°å', 'ãƒ¡ãƒ¼ãƒ«', 'éƒ¨ç½²', 'Gmail', 'Calendar', 'Chat', 'Drive', 'å®Ÿè¡Œæ™‚é–“(ms)', 'è©³ç´°']
    ]);
  }
  
  return logSheet;
}</div>
        </div>

        <h2>ğŸ“Š å®Ÿè¡Œçµæœã¨åŠ¹æœæ¸¬å®š</h2>
        
        <div class="feature-highlight">
            <h3>ğŸš€ çµ±åˆAPIé€£æºã®åœ§å€’çš„åŠ¹æœ</h3>
            
            <div class="api-grid">
                <div class="api-card">
                    <h4>ğŸ“§ Gmail API</h4>
                    <p><strong>æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ä»˜ããƒ¡ãƒ¼ãƒ«</strong></p>
                    <p>éƒ¨ç½²åˆ¥è³‡æ–™ã‚’è‡ªå‹•æ·»ä»˜</p>
                </div>
                <div class="api-card">
                    <h4>ğŸ“… Calendar API</h4>
                    <p><strong>3ã¤ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ç™»éŒ²</strong></p>
                    <p>é¢è«‡ãƒ»ç ”ä¿®ãƒ»ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—</p>
                </div>
                <div class="api-card">
                    <h4>ğŸ’¬ Chat API</h4>
                    <p><strong>éƒ¨ç½²åˆ¥ãƒªãƒƒãƒé€šçŸ¥</strong></p>
                    <p>ITãƒ»ç·å‹™ãƒ»é…å±éƒ¨ç½²ã«é€šçŸ¥</p>
                </div>
                <div class="api-card">
                    <h4>ğŸ“ Drive API</h4>
                    <p><strong>å€‹äººãƒ•ã‚©ãƒ«ãƒ€è‡ªå‹•ä½œæˆ</strong></p>
                    <p>6ã¤ã®ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã¨å¿…è¦æ›¸é¡</p>
                </div>
            </div>
            
            <div class="before-after">
                <div>
                    <h4>â±ï¸ å‡¦ç†æ™‚é–“åŠ¹æœ</h4>
                    <ul>
                        <li><strong>æ‰‹å‹•ä½œæ¥­æ™‚é–“:</strong> 120åˆ†</li>
                        <li><strong>è‡ªå‹•å‡¦ç†æ™‚é–“:</strong> 10ç§’</li>
                        <li><strong>æ™‚é–“å‰Šæ¸›ç‡:</strong> 99.9%</li>
                        <li><strong>åŒæ™‚å‡¦ç†æ•°:</strong> 15+ æ“ä½œ</li>
                    </ul>
                </div>
                <div>
                    <h4>ğŸ¯ å“è³ªå‘ä¸ŠåŠ¹æœ</h4>
                    <ul>
                        <li><strong>ä½œæ¥­æ¼ã‚Œ:</strong> 0%ï¼ˆç¢ºå®Ÿå®Ÿè¡Œï¼‰</li>
                        <li><strong>ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§:</strong> 100%</li>
                        <li><strong>æƒ…å ±ã®é®®åº¦:</strong> ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ </li>
                        <li><strong>æ‹¡å¼µæ€§:</strong> æ–°APIè¿½åŠ å®¹æ˜“</li>
                    </ul>
                </div>
            </div>
            
            <div class="highlight-box">
                <h4 style="color: white;">ğŸ¯ é©å‘½çš„ãªæˆæœ</h4>
                <p style="color: white; font-size: 18px;">
                    <strong>4ã¤ã®Google APIãŒå®Œç’§ã«é€£æºã—ã€2æ™‚é–“ã®ä½œæ¥­ãŒ10ç§’ã§å®Œäº†ï¼</strong><br>
                    ã“ã‚ŒãŒçœŸã®çµ±åˆè‡ªå‹•åŒ–ã®å¨åŠ›ã§ã™ã€‚
                </p>
            </div>
        </div>

        <h2>ğŸ”® æ¬¡å›äºˆå‘Š</h2>
        
        <div class="feature-highlight">
            <h3>å‹•ç”»7: Google Workspaceå®Œçµï¼ã‚¿ã‚¹ã‚¯ç®¡ç†ã¨Chaté€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ </h3>
            <p>ã“ã®çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã‚’ã•ã‚‰ã«ç™ºå±•ã•ã›ã¦ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹ã®ã‚¿ã‚¹ã‚¯ç®¡ç†ã¨Google Chatã«ã‚ˆã‚‹è‡ªå‹•ãƒªãƒã‚¤ãƒ³ãƒ‰æ©Ÿèƒ½ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>
            
            <div class="success-tip">
                <strong>ğŸ¯ æ¬¡å›ã®å­¦ç¿’å†…å®¹:</strong>
                <ul>
                    <li>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè‡ªå‹•ã‚¿ã‚¹ã‚¯ç”Ÿæˆ</li>
                    <li>Google Chat ãƒªãƒƒãƒã‚«ãƒ¼ãƒ‰é€šçŸ¥</li>
                    <li>æ™‚é–“ãƒ™ãƒ¼ã‚¹ãƒˆãƒªã‚¬ãƒ¼ã«ã‚ˆã‚‹è‡ªå‹•ãƒªãƒã‚¤ãƒ³ãƒ‰</li>
                    <li>å®Œäº†çŠ¶æ³ã®å¯è¦–åŒ–ã¨å ±å‘Š</li>
                </ul>
            </div>
        </div>

        <div style="text-align: center; margin-top: 40px; padding: 20px; background: #e8f0fe; border-radius: 8px;">
            <h3>ğŸ‰ Google APIsçµ±åˆé€£æºã€å®Œæˆï¼</h3>
            <p style="font-size: 18px; color: #2c3e50;">æ¬¡å›ã¯ã€ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¿ã‚¹ã‚¯ç®¡ç†æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p>
        </div>
    </div>
</body>
</html>