# 動画6 統合版実装 - 設定ガイド

## 🚀 初期設定の手順

### 1. 設定値の準備

以下の情報を事前に準備してください：

#### 📝 必須設定
- **OpenAI API キー**
  - [OpenAI Platform](https://platform.openai.com/)でアカウント作成
  - API Keysページで新規キーを生成

- **Google Drive フォルダID**
  - 従業員フォルダを作成する親フォルダを用意
  - フォルダを開いてURLから`folders/`以降の文字列をコピー
  - 例: `https://drive.google.com/drive/folders/1234567890abcdef` → `1234567890abcdef`

- **Google Chat Webhook URL**
  - Google Chatの対象スペースで「アプリと統合」→「Webhook」を設定
  - 生成されたURLをコピー

#### 📂 オプション設定
- 会社案内PDFのファイルID
- 部署別ガイドのファイルID
- テンプレートフォルダのID

### 2. コードの設定

1. Google Apps Scriptエディタで`initialSetup()`関数を開く
2. 設定値を入力：

```javascript
const config = {
  // ChatGPT API設定
  'OPENAI_API_KEY': 'sk-xxxxxxxxxxxxxx',  // あなたのAPIキー
  
  // Google Drive設定
  'EMPLOYEE_ROOT_FOLDER_ID': '1234567890abcdef',  // 従業員フォルダの親ID
  
  // Google Chat Webhook
  'IT_CHAT_WEBHOOK': 'https://chat.googleapis.com/v1/spaces/xxx/messages?key=xxx',
  // ... 他の設定
};
```

3. `initialSetup()`関数を実行
4. 実行ログで設定状況を確認

### 3. Google APIの有効化

Google Apps Scriptエディタで：
1. 「サービス」をクリック
2. 以下のAPIを追加：
   - **Gmail API** (Gmail)
   - **Calendar API** (Calendar)
   - **Drive API** (Drive)

### 4. 部署別カレンダーIDの設定

`getDepartmentCalendarId()`関数で各部署のカレンダーIDを設定：

```javascript
const calendarIds = {
  '営業部': 'sales-dept-calendar@group.calendar.google.com',
  '開発部': 'dev-dept-calendar@group.calendar.google.com',
  // ... 実際のカレンダーIDに置き換え
};
```

### 5. トリガーの設定

1. Google Apps Scriptエディタで「トリガー」をクリック
2. 「トリガーを追加」
3. 以下を設定：
   - 実行する関数: `onFormSubmit`
   - イベントのソース: 「スプレッドシートから」
   - イベントの種類: 「フォーム送信時」

## 🔍 設定の確認

設定が正しく行われているか確認：

```javascript
// 設定確認関数を実行
checkSettings();
```

実行結果で以下を確認：
- ✅ 設定済み
- ❌ 未設定（要対応）

## 📋 チェックリスト

- [ ] OpenAI API キーを取得・設定
- [ ] 従業員用フォルダの親フォルダIDを設定
- [ ] IT部門のChat Webhook URLを設定
- [ ] 総務部のChat Webhook URLを設定
- [ ] Gmail API を有効化
- [ ] Calendar API を有効化
- [ ] Drive API を有効化
- [ ] 部署別カレンダーIDを設定
- [ ] フォーム送信トリガーを設定
- [ ] テスト送信で動作確認

## 🆘 トラブルシューティング

### エラー: "API is not enabled"
→ Google Apps Scriptの「サービス」で該当APIを追加

### エラー: "Invalid API key"
→ OpenAI APIキーが正しいか確認

### エラー: "Folder not found"
→ フォルダIDが正しいか、アクセス権限があるか確認

### Chat通知が届かない
→ Webhook URLが正しいか、スペースの設定を確認

## 📞 サポート

設定で困った場合は、動画のコメント欄またはサポートフォーラムでお問い合わせください。