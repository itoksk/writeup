# 動画7 タスク管理機能の追加方法

## 概要
動画7の高度なタスク管理機能を既存の`integrated_onboarding_system.gs`に追加する手順です。

## 追加される機能

1. **自動タスク生成システム**
   - 新入社員データから必要なタスクを自動判定・生成
   - スプレッドシートベースのタスク管理
   - 部署別・職種別の具体的なタスク自動生成

2. **Google Chatリッチカード通知**
   - 優先度別のタスク表示
   - インタラクティブなボタン付きカード
   - 部署別の詳細なタスク通知

3. **時間ベース自動リマインダー**
   - 期限前日の自動リマインド
   - 期限切れタスクのアラート
   - 日次進捗チェック（毎朝9時）

4. **進捗管理・レポートシステム**
   - 完了状況の自動集計
   - 部署別パフォーマンス可視化
   - 人事部向け統合レポート

## 追加手順

### 1. 設定項目の追加

`integrated_onboarding_system.gs`の上部にある`CONFIG`オブジェクトに以下を追加：

```javascript
// Google Chat通知設定に追加
CHAT_WEBHOOKS: {
  // 既存の設定...
  SALES_DEPT: PropertiesService.getScriptProperties().getProperty('SALES_CHAT_WEBHOOK') || '',
  DEV_DEPT: PropertiesService.getScriptProperties().getProperty('DEV_CHAT_WEBHOOK') || '',
  MKT_DEPT: PropertiesService.getScriptProperties().getProperty('MKT_CHAT_WEBHOOK') || '',
  HR_DEPT: PropertiesService.getScriptProperties().getProperty('HR_CHAT_WEBHOOK') || ''
},

// タスク管理設定を追加
TASK_SETTINGS: {
  SHEET_NAME: 'タスク管理',  // タスク管理シート名
  REMINDER_DAYS_BEFORE: 1,    // リマインダーを送る日数（期限の何日前）
  DAILY_CHECK_HOUR: 9         // 日次チェックの実行時刻（何時）
}
```

### 2. 統合実行関数の更新

`executeIntegratedAutomation`関数内の`results`オブジェクトに追加：

```javascript
const results = {
  email: sendWelcomeEmailWithAttachments(employeeData),
  calendar: createMultipleCalendarEvents(employeeData),
  chat: sendDepartmentChatNotifications(employeeData),
  files: createEmployeeFolder(employeeData),
  tasks: createTasksAndSendNotifications(employeeData)  // 新規追加
};
```

### 3. 動画7の関数を追加

`integrated_onboarding_system.gs`の末尾に、動画7の以下の関数を追加：

1. `createTasksAndSendNotifications()` - メイン実行関数
2. `createEmployeeTasks()` - タスク生成
3. `sendDetailedDepartmentNotifications()` - 詳細通知送信
4. `generateDepartmentTasks()` - 部署別タスク生成
5. `getDepartmentSpecificTasks()` - 部署固有タスク
6. `createDetailedDepartmentMessage()` - 詳細メッセージ作成
7. `setupProgressTracking()` - 進捗追跡設定
8. `sendTaskReminders()` - リマインダー送信
9. `checkTaskCompletion()` - 完了確認
10. `createReminderMessage()` - リマインダーメッセージ
11. `createCompletionReport()` - 完了レポート
12. その他のユーティリティ関数

### 4. 既存のChat通知機能との使い分け

既存の`sendDepartmentChatNotifications()`関数は基本的な通知用として残し、動画7の高度な通知は別関数として実装します。

### 5. ログ機能の更新

`logIntegrationResults`関数を更新して、タスク数もログに記録：

```javascript
logSheet.appendRow([
  new Date(),
  employeeData.name,
  employeeData.email,
  results.email.success ? '成功' : '失敗',
  results.calendar.count || 0,
  results.chat.filter(r => r.success).length,
  results.files.success ? '成功' : '失敗',
  results.tasks ? results.tasks.totalTasks || 0 : 0,  // 追加
  JSON.stringify(results)
]);
```

## 設定が必要なWebhook URL（任意）

スクリプトプロパティに以下を設定（使用する場合のみ）：

- `SALES_CHAT_WEBHOOK` - 営業部のChat Webhook URL
- `DEV_CHAT_WEBHOOK` - 開発部のChat Webhook URL  
- `MKT_CHAT_WEBHOOK` - マーケティング部のChat Webhook URL
- `HR_CHAT_WEBHOOK` - 人事部のChat Webhook URL

## 実行後の動作

1. フォーム送信時に自動的にタスクが生成される
2. 該当部署にリッチカード形式で通知が送信される
3. 期限前日に自動リマインダーが送信される
4. 入社3日後に完了確認が実行される

## 注意事項

- タスク管理シートは自動的に作成されます
- Webhook URLが設定されていない部署への通知はスキップされます
- リマインダーや完了確認は時間ベーストリガーで自動実行されます