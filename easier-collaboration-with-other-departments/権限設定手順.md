# Google Apps Script 権限設定手順

## エラーが発生した場合の対処法

### 1. Google Apps Script エディタで権限を設定

1. Google Apps Script エディタを開く
2. **プロジェクトの設定** をクリック
3. **「appsscript.json」マニフェスト ファイルをエディタで表示する** にチェック
4. エディタに戻って **appsscript.json** タブを開く
5. 以下の内容をコピーして貼り付け：

```json
{
  "timeZone": "Asia/Tokyo",
  "dependencies": {
    "enabledAdvancedServices": [
      {
        "userSymbol": "Gmail",
        "version": "v1",
        "serviceId": "gmail"
      },
      {
        "userSymbol": "Calendar",
        "version": "v3",
        "serviceId": "calendar"
      }
    ]
  },
  "exceptionLogging": "STACKDRIVER",
  "oauthScopes": [
    "https://www.googleapis.com/auth/spreadsheets",
    "https://www.googleapis.com/auth/script.send_mail",
    "https://www.googleapis.com/auth/gmail.send",
    "https://www.googleapis.com/auth/calendar",
    "https://www.googleapis.com/auth/drive",
    "https://www.googleapis.com/auth/documents",
    "https://www.googleapis.com/auth/script.external_request"
  ],
  "runtimeVersion": "V8"
}
```

### 2. APIサービスを有効化

1. Apps Script エディタの左側メニューから **サービス** をクリック
2. 以下のサービスを追加：
   - **Gmail API** → 追加
   - **Google Calendar API** → 追加

### 3. 初回実行時の承認

1. **testIntegratedSystem** 関数を実行
2. 「承認が必要です」というダイアログが表示される
3. **許可を確認** をクリック
4. Googleアカウントを選択
5. 「詳細」をクリック → 「（安全ではないページ）に移動」をクリック
6. 必要な権限を確認して **許可** をクリック

### 4. 権限エラーが続く場合

DocumentApp.createのエラーが続く場合は、コードは既に修正済みで：
- 会社案内：PDFの代わりにHTMLファイルを作成
- ウェルカムガイド：Googleドキュメントの代わりにテキストファイルを作成

これらの変更により、特別な権限なしで動作します。

### 5. トラブルシューティング

- **MailApp.sendEmailエラー**: メール送信権限が必要です。上記手順3の承認を完了してください
- **Calendar APIエラー**: サービスの追加（手順2）を確認してください
- **Drive APIエラー**: 通常は自動的に権限が付与されます

権限設定後、もう一度関数を実行してください。