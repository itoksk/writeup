# 動画4: Googleドキュメントテンプレートで見積書・請求書を自動出力する

## 想定時間: 10分

## 学習目標
- Googleドキュメントテンプレートの作成方法を学ぶ（5テーブル構成に基づく）
- AppSheetのプレースホルダー（<<[カラム名]>>）の使い方を習得する
- 参照型カラムと親子関係を使ったテンプレートの書き方を理解する
- Bot（Automation）を使った自動ドキュメント生成の設定方法を学ぶ
- PDF出力の設定方法とトラブルシューティングを理解する

---

## 0:00-0:45 オープニング（導入）

【画面指示】
- materials.htmlの冒頭部分を表示
- 「Googleドキュメントテンプレートで見積書・請求書を自動出力する」タイトル画面

【セリフ】

皆さん、こんにちは。本日は第4回「Googleドキュメントテンプレートで見積書・請求書を自動出力する」です。

前回の動画3では、注文フォームと注文一覧をカスタマイズして、使いやすいUI/UXを実現しました。

今回は、注文データから見積書や請求書をPDF形式で自動出力する方法を学びます。

AppSheetでは、Googleドキュメントのテンプレートを使って、データベースの情報を差し込んだ書類をPDFとして自動生成できます。これにより、手作業でのコピー&ペーストが不要になり、大幅な業務効率化が実現できます。

今回は、5テーブル構成（顧客、社員、サービス、注文、注文詳細）のデータを使って、Bot機能で見積書や請求書を自動生成する方法を実践的に学びます。

それでは始めましょう！

---

## 0:45-4:00 Googleドキュメントテンプレートの作成（3分15秒）

【画面指示】
- Googleドキュメントを新規作成
- 見積書のテンプレートを実際に作成していく過程を画面共有
- プレースホルダーの記法を強調表示

【セリフ】

それでは、Googleドキュメントで見積書のテンプレートを作成していきましょう。

**ステップ1: 新しいGoogleドキュメントを作成**

Google Driveを開いて、「新規」→「Googleドキュメント」→「空白のドキュメント」をクリックします。

ドキュメントのタイトルを「見積書テンプレート」に変更します。

**ステップ2: 基本的なレイアウトを作成**

まず、見積書の基本的なレイアウトを作成します。以下のような構成にします：

```
================================
見積書
================================

見積番号:
発行日:
有効期限:

---

【お客様情報】
顧客名:
顧客住所:
顧客電話番号:

【担当者情報】
担当社員名:
担当社員電話番号:

---

【サービス明細】

サービス名 | 数量 | 単価 | 金額
----- | ----- | ----- | -----


---

合計金額:

---

【その他】
納入期日:
納入場所:
御支払い条件:
備考:
```

**ステップ3: プレースホルダーを挿入**

次に、AppSheetから自動的にデータを差し込むための「プレースホルダー」を挿入します。

プレースホルダーは、`<<[カラム名]>>` という形式で記述します。

それでは、各項目にプレースホルダーを挿入していきましょう。

**見積番号、発行日、有効期限**

```
見積番号: <<[見積番号]>>
発行日: <<[発行日]>>
有効期限: <<[有効期限]>>
```

これらは、注文テーブルの「見積番号」「発行日」「有効期限」カラムから自動的に値が挿入されます。

**顧客情報（参照型カラムを使用）**

顧客情報は、注文テーブルから「ID顧客」を参照して、顧客テーブルの値を取得します。

参照型カラムのプレースホルダーは、`<<[Refカラム名].[参照先カラム名]>>` という形式で記述します。

```
顧客名: <<[ID顧客].[顧客名]>>
顧客住所: <<[ID顧客].[顧客住所]>>
顧客電話番号: <<[ID顧客].[顧客電話番号]>>
```

**担当者情報（参照型カラムを使用）**

同様に、担当社員の情報も参照型カラムで取得します。

```
担当社員名: <<[ID社員].[社員名]>>
担当社員電話番号: <<[ID社員].[電話番号]>>
```

**サービス明細（繰り返しプレースホルダーを使用）**

サービス明細は、注文詳細テーブルのレコードを繰り返し表示します。

繰り返しプレースホルダーは、`<<Start:[Listカラム名]>>` ... `<<End:[Listカラム名]>>` という形式で記述します。

注文テーブルには、親子関係により「Related 注文詳細s」という仮想カラムが自動生成されています。この仮想カラムを使って、注文詳細のリストを取得します。

```
【サービス明細】

<<Start:[Related 注文詳細s]>>
<<[IDサービス].[サービス名]>> | <<[数量]>> | <<[IDサービス].[価格]>>円 | <<[金額]>>円
<<End:[Related 注文詳細s]>>
```

このように記述すると、注文に紐づくすべての注文詳細が繰り返し表示されます。

**合計金額（仮想カラムを使用）**

合計金額は、注文テーブルの仮想カラム「合計金額」から取得します。

```
合計金額: <<[合計金額]>>円
```

**その他の情報**

```
納入期日: <<[納入期日]>>
納入場所: <<[納入場所]>>
御支払い条件: <<[御支払い条件]>>
備考: <<[備考]>>
```

これで、見積書テンプレートの作成が完了しました。

**ステップ4: テンプレートを保存**

ドキュメントのタイトルを「見積書テンプレート」として保存します。

このテンプレートは、Google Driveの特定のフォルダに保存しておくと、後で管理しやすくなります。

---

## 4:00-7:00 AppSheetでの自動ドキュメント生成設定（3分）

【画面指示】
- AppSheet Editorの画面
- Automationタブを開く
- 新しいBotを作成していく過程を実演

【セリフ】

それでは、AppSheetで自動ドキュメント生成を設定していきましょう。

**ステップ1: Automationタブを開く**

AppSheet Editorの左側メニューから「Automation」タブをクリックします。

**ステップ2: 新しいBotを作成**

「Bots」セクションの「+ Create a new bot」ボタンをクリックします。

Botの名前を「見積書自動生成」に設定します。

**ステップ3: Eventを設定（トリガー条件）**

まず、「When should the bot run?」のセクションで、Botが実行されるタイミングを設定します。

「Event」の「+ Configure event」ボタンをクリックします。

- **Event Name**: 「注文データ変更時」
- **Table**: 「注文」を選択
- **Event Type**: 「Adds and Updates」を選択（新規作成と更新の両方で実行）
- **Condition**: ここでは条件を設定せず、すべての注文に対して実行されるようにします（後でフィルタをかけることも可能）

「Save」ボタンをクリックして、Eventを保存します。

**ステップ4: Processを設定（実行内容）**

次に、「What should the bot do?」のセクションで、Botが実行する処理を設定します。

「Process」の「+ Configure process」ボタンをクリックします。

- **Process Name**: 「見積書PDF生成」
- **Process Type**: 「Run a task」を選択

「Tasks」セクションで、「+ Add a step」ボタンをクリックします。

- **Step Name**: 「見積書PDF作成」
- **Step Type**: 「Create a file from a template」を選択
- **Template File**: Google Driveから「見積書テンプレート」を選択
- **Output File Name**: `CONCATENATE("見積書_", [見積番号], ".pdf")` と入力（見積番号を含むファイル名で保存）
- **Output Folder**: 生成されたPDFを保存するGoogle Driveのフォルダを選択
- **Output Format**: 「PDF」を選択

「Save」ボタンをクリックして、Processを保存します。

**ステップ5: Botを有効化**

Botの設定画面に戻り、「Status」を「Enabled」に変更します。

これで、注文データが作成または更新されるたびに、自動的に見積書PDFが生成されるようになりました。

**ステップ6: 動作確認**

プレビュー画面で、注文を新規作成してみましょう。

「+」ボタンをクリックして、注文フォームを開きます。

顧客、担当社員、サービスなどを選択して、注文を保存します。

保存後、Google Driveの指定フォルダに見積書PDFが自動生成されていることを確認してください。

PDFを開いて、プレースホルダーが正しくデータで置き換わっているか確認しましょう。

---

## 7:00-9:00 請求書テンプレートの作成と設定（2分）

【画面指示】
- 見積書テンプレートをコピーして、請求書テンプレートを作成
- 請求書用のBotを設定

【セリフ】

次に、請求書テンプレートも同じ要領で作成しましょう。

**ステップ1: 見積書テンプレートをコピー**

Google Driveで「見積書テンプレート」を右クリック→「コピーを作成」を選択します。

コピーされたドキュメントのタイトルを「請求書テンプレート」に変更します。

**ステップ2: 請求書用に内容を調整**

ドキュメントの内容を請求書用に調整します。

```
================================
請求書
================================

請求番号: <<[請求番号]>>
発行日: <<[発行日]>>
振込期限: <<[振込期限]>>

---

【お客様情報】
顧客名: <<[ID顧客].[顧客名]>>
顧客住所: <<[ID顧客].[顧客住所]>>
顧客電話番号: <<[ID顧客].[顧客電話番号]>>

【担当者情報】
担当社員名: <<[ID社員].[社員名]>>
担当社員電話番号: <<[ID社員].[電話番号]>>

---

【サービス明細】

<<Start:[Related 注文詳細s]>>
<<[IDサービス].[サービス名]>> | <<[数量]>> | <<[IDサービス].[価格]>>円 | <<[金額]>>円
<<End:[Related 注文詳細s]>>

---

合計金額: <<[合計金額]>>円

---

【お支払い情報】
御支払い条件: <<[御支払い条件]>>
振込期限: <<[振込期限]>>
備考: <<[備考]>>
```

見積書との違いは、「見積番号」が「請求番号」に、「有効期限」が「振込期限」になっている点です。

**ステップ3: 請求書用のBotを作成**

AppSheetのAutomationタブに戻り、見積書の時と同じ要領で「請求書自動生成」Botを作成します。

- **Event**: 注文データ変更時
- **Process**: 請求書PDF作成（テンプレートとして「請求書テンプレート」を選択）
- **Output File Name**: `CONCATENATE("請求書_", [請求番号], ".pdf")`

これで、見積書と請求書の両方が自動生成されるようになりました。

---

## 9:00-9:30 ベストプラクティスとトラブルシューティング（30秒）

【画面指示】
- materials.htmlの「ベストプラクティス」セクション

【セリフ】

テンプレートを作成する際のベストプラクティスをまとめます。

**ベストプラクティス1: プレースホルダーの正確な記述**

プレースホルダーは、`<<[カラム名]>>` という形式で正確に記述する必要があります。スペースや全角文字が混入すると、正しく動作しません。

**ベストプラクティス2: 参照型カラムの活用**

顧客情報や社員情報など、関連するテーブルの情報は、参照型カラムを使って取得します。`<<[Refカラム名].[参照先カラム名]>>` という形式で記述します。

**ベストプラクティス3: 繰り返しプレースホルダーの使用**

注文詳細のような繰り返しデータは、`<<Start:[Listカラム名]>>` ... `<<End:[Listカラム名]>>` という形式で記述します。

**よくあるトラブル**

もしテンプレートが正しく動作しない場合、以下を確認してください：

- プレースホルダーのカラム名が、実際のテーブルのカラム名と一致しているか
- 参照型カラムの記法が正しいか（`<<[Refカラム名].[参照先カラム名]>>`）
- 繰り返しプレースホルダーの開始タグと終了タグが正しく対応しているか

---

## 9:30-10:00 まとめと次回予告（30秒）

【画面指示】
- materials.htmlの「まとめと次回予告」セクション

【セリフ】

本日は、Googleドキュメントテンプレートを使って、見積書や請求書を自動生成する方法を学びました。

5テーブル構成（顧客、社員、サービス、注文、注文詳細）のデータを活用して、参照型カラムや親子関係を使ったテンプレートの書き方を習得しました。

また、AppSheetのBot機能を使って、データ変更時に自動的にPDFを生成し、Google Driveに保存する設定も実践しました。

プレースホルダーの記法や、繰り返しセクションの使い方、トラブルシューティングのポイントもしっかり押さえておきましょう。

次回の動画5では、「アクションで『請求作成』ボタンを作る」というテーマで、ボタン1つで業務フローを進められるアクション機能の使い方を実践します。

それでは、次回の動画でお会いしましょう！

---

## 補足資料

### プレースホルダーの記法まとめ

**基本形（単一カラム）**
```
<<[カラム名]>>
```

**参照型カラム（Ref）**
```
<<[Refカラム名].[参照先カラム名]>>
```

**繰り返しプレースホルダー（List）**
```
<<Start:[Listカラム名]>>
<<[サブカラム名]>>
<<End:[Listカラム名]>>
```

**仮想カラム（Virtual Column）**
```
<<[仮想カラム名]>>
```

**式（Expression）**
```
<<CONCATENATE([カラム1], " ", [カラム2])>>
```

### 参考リンク
- [AppSheet Document Generation](https://help.appsheet.com/en/articles/2357619-generate-documents)
- [AppSheet Templates](https://help.appsheet.com/en/articles/2357620-create-a-document-template)
- [AppSheet Automation](https://help.appsheet.com/en/articles/961632-automation-bots)

### よくある質問

**Q: テンプレートで日付のフォーマットを変更できますか？**
A: はい、TEXT関数を使ってフォーマットできます。例：`<<TEXT([発行日], "YYYY年MM月DD日")>>`

**Q: 繰り返しプレースホルダーで、データがない場合はどうなりますか？**
A: データがない場合、その部分は空白になります。「データがありません」のようなメッセージを表示したい場合は、IFS関数を使って条件分岐を設定できます。

**Q: PDFではなくGoogleドキュメント形式で保存できますか？**
A: はい、Output Formatで「Google Docs」を選択すると、Googleドキュメント形式で保存されます。

**Q: 生成されたPDFを自動的にメール送信できますか？**
A: はい、Automation Processのタスクとして「Send an email」を追加することで、生成されたPDFを自動的にメール送信できます。次回以降の動画でオートメーションの詳細を学びます。

### 今日のチェックリスト

- [ ] Googleドキュメントで見積書テンプレートを作成できた
- [ ] プレースホルダー（<<[カラム名]>>）を正しく記述できた
- [ ] 参照型カラムのプレースホルダー（<<[Ref].[カラム]>>）を使用できた
- [ ] 繰り返しプレースホルダー（<<Start:[List]>>...<<End:[List]>>）を使用できた
- [ ] AppSheetのAutomation機能でBotを作成できた
- [ ] PDF自動生成が動作することを確認できた
- [ ] 請求書テンプレートも作成できた
- [ ] 次回のテーマ（アクションとオートメーション）を確認できた
