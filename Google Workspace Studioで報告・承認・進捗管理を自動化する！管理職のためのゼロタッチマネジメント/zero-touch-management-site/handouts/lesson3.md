# 第3回：合格・要修正・再提出を条件分岐で仕分ける！チェックリストを自動で判定する審査フロー

## 学習目標

日報・週報の品質をチェックリストで自動判定し、APPROVED（合格）/ NEEDS_REVISION（要修正）/ RESUBMIT（再提出）の3段階で条件分岐処理を実装。提出者への即時フィードバックと管理者への通知を自動化するQuality Check Agentを構築します。

---

## BEFORE / AFTER

| Before（受講前） | After（受講後） |
|---|---|
| 品質チェックを毎日30分手動で実施 | AIが自動判定でチェック時間90%削減 |
| 判定基準が曖昧で属人的 | 判定基準が統一・明確・公平に |
| フィードバックが翌日以降に遅延 | 即時フィードバックで改善サイクル加速 |
| 同じ指摘を繰り返す非効率 | Quality Check Agentを構築 |

---

## エージェント作成プロンプト

以下のプロンプトをコピーして、Google Workspace Studio（https://studio.workspace.google.com/）で実行してください。

```
品質チェックエージェントを作成してください。

【エージェント名】
週報品質チェック

【説明】
週報専用スペースに投稿された週報の品質を自動チェックし、適切なアクションにルーティング

【スターター】
Chat - チャットメッセージを受け取ったとき
会話の種類: スペースと名前付きグループDM
スペース: 週報専用スペース（事前に作成しておく）
※メッセージに「週報」というキーワードが含まれる投稿を対象

【処理フロー】
1. Geminiステップ（週報の品質チェック）:
   投稿された週報の内容を以下のチェックリストで評価:
   - 業務内容: 具体的な作業が記載されているか（必須）
   - 進捗状況: 数値や達成率が含まれているか（必須）
   - 課題: 課題がある場合に記載されているか（任意）
   - 次週予定: 次週の計画が記載されているか（必須）
   - 文字数: 最低300文字以上か（必須）

   判定基準:
   - APPROVED: 全必須項目OK、軽微な指摘0〜1件
   - NEEDS_REVISION: 必須項目OK、軽微な指摘2件以上
   - RESUBMIT: 必須項目に不備あり

2. 抽出ステップ（Sheets記録用データ抽出）:
   Geminiの出力から以下を個別変数として抽出:
   - judgment: APPROVED / NEEDS_REVISION / RESUBMIT
   - feedback: 提出者向けフィードバック
   - checklist_業務内容: OK / NG
   - checklist_進捗状況: OK / NG
   - checklist_課題: OK / NG / N/A
   - checklist_次週予定: OK / NG
   - checklist_文字数: OK / NG

3. 条件分岐ステップ:
   - APPROVED → 承認通知をChat DMで自分に送信
   - NEEDS_REVISION → 修正依頼をChat DMで自分に送信
   - RESUBMIT → 再提出依頼をChat DMで自分に送信

4. Sheetsステップ:
   - 抽出した変数を使って品質チェックログシートに記録

【出力先】
- Chat DM（自分へ通知、手動で転送）
- Sheets（品質チェックログ）

【事前準備】
1. Google Chatで「週報提出」などの名前でスペースを作成し、チームメンバーを招待
2. Googleスプレッドシートで品質チェックログシートを作成
   （列: 日付, 提出者, 判定, 業務内容, 進捗状況, 課題, 次週予定, 文字数, フィードバック）

このエージェントを作成してください。
```

---

## 判定基準の定義

| 判定 | 条件 | アクション |
|---|---|---|
| **APPROVED** | 全必須項目OK、軽微な指摘0〜1件 | 承認通知を送信 |
| **NEEDS_REVISION** | 必須項目は満たす、軽微な指摘2件以上 | 修正依頼を送信 |
| **RESUBMIT** | 必須項目に不備あり、重大な欠落がある | 再提出依頼 + 管理者通知 |

---

## エージェントフロー

```
Chatスペース受信 → Gemini判定 → 抽出 → 条件分岐 → Chat DM / Sheets
```

---

## エージェント設計

| 項目 | 設定値 |
|---|---|
| エージェント名 | 品質チェック |
| 説明 | 提出物の品質を自動チェックし、適切なアクションにルーティング |
| スターター | Chat - チャットメッセージを受け取ったとき |
| フィルター | 週報専用スペースへの投稿（「週報」キーワード含む） |
| 処理ステップ1 | Geminiによるチェックリスト評価 |
| 処理ステップ2 | 抽出ステップで判定結果を変数化 |
| 条件分岐 | APPROVED / NEEDS_REVISION / RESUBMIT |
| 出力（提出者へ） | Chat DM（自分）でフィードバック受信 → 手動で転送 ※外部送信は未対応 |
| 出力（Sheets） | ステータス更新と判定詳細の記録 |
| 出力（管理職へ） | Chat DM通知（RESSUBMITの場合のみ） |

---

## 週報・月報チェックリスト項目

| 項目 | 必須 | チェック内容 | NG例 |
|---|---|---|---|
| 業務内容 | 必須 | 具体的な作業が記載されているか | 「業務した」のみ |
| 進捗状況 | 必須 | 数値や達成率が含まれているか | 「順調」のみ |
| 課題 | 任意 | 課題がある場合に記載されているか | 課題あるのに未記載 |
| 次週予定 | 必須 | 次週の計画が記載されているか | 「引き続き」のみ |
| 文字数 | 必須 | 最低300文字以上か | 200文字未満 |

**Lesson 2との違い:** Lesson 2は日報専用スペースで短文の日報を要約、Lesson 3は週報専用スペースで週報の品質をチェックリストで評価・判定します。週報は詳細な記載が求められるため、文字数基準も高く設定しています。

---

## 作成ステップ

1. **新規エージェント作成**: studio.workspace.google.com → 「新規作成」→ エージェント名「週報品質チェック」を入力

2. **Chatスターター設定**: スターター: Chat - チャットメッセージを受け取ったとき → 会話の種類: スペースと名前付きグループDM → スペース: 週報専用スペースを選択

3. **Geminiステップで品質チェック**: ステップを追加 → 「Gemini」を選択 → チャットメッセージの内容を入力として、下記のチェックリスト評価プロンプトを設定

4. **抽出ステップでデータを変数化**: ステップを追加 → 「抽出」を選択 → Gemini出力から judgment, feedback, checklist_* を個別変数として抽出

5. **条件分岐ステップ設定**: ステップを追加 → 「条件分岐」→ 抽出した judgment 変数で APPROVED / NEEDS_REVISION / RESUBMIT に分岐

6. **Chat DMステップ設定**: 各分岐にChat DM送信ステップを追加。自分宛に通知を受け取り、承認・修正依頼・再提出依頼の結果を確認後、手動で提出者へ転送

7. **Sheetsステップ設定**: ステップを追加 → Sheets「行を追加」→ 品質チェックログシートを選択 → 抽出した変数（日付, 提出者, judgment, checklist_*, feedback）をマッピング

8. **テスト実行と有効化**: テスト用の週報を週報専用スペースに投稿 → 品質チェック結果とSheets記録を確認 → 「有効化」で本番稼働

---

## 品質チェックプロンプト

```
You are a quality control assistant checking weekly reports posted in chat.

Weekly report content (from chat message):
---
{chat_message_content}
---

Checklist for weekly/monthly reports:
1. 業務内容: 具体的な作業が記載されているか (Required)
2. 進捗状況: 数値や達成率が含まれているか (Required)
3. 課題: 課題がある場合に記載されているか (Optional)
4. 次週予定: 次週の計画が記載されているか (Required)
5. 文字数: 最低300文字以上か (Required - 週報・月報は詳細が必要)

For each item, evaluate:
- Status: OK / NG / N/A
- Comment: If NG, provide specific improvement suggestion

Then provide overall judgment:
- APPROVED: All required items OK, minor issues 0-1
- NEEDS_REVISION: All required items OK, minor issues 2+
- RESUBMIT: Any required item NG

Output format:
---
CHECKLIST_RESULT:
1. 業務内容: [OK/NG] - [具体的なコメント]
2. 進捗状況: [OK/NG] - [具体的なコメント]
3. 課題: [OK/NG/N/A] - [具体的なコメント]
4. 次週予定: [OK/NG] - [具体的なコメント]
5. 文字数: [OK/NG] - [現在の文字数]

JUDGMENT: [APPROVED/NEEDS_REVISION/RESUBMIT]
FEEDBACK: [提出者向けの具体的なフィードバック（日本語）]
---
```

---

## テスト用週報サンプル

### サンプル1: APPROVED（承認）パターン

```
週報 - 山田太郎
2024年1月15日〜1月19日

■ 今週の業務内容

1. A社向け提案資料の作成と商談実施
   - 1/15: 提案資料のドラフト作成（8時間）
   - 1/16: 上司レビューを受けて修正（3時間）
   - 1/17: A社訪問、提案プレゼンテーション実施（2時間）
   - 結果: 概ね好評、来週に見積もり提出予定

2. B社システム開発プロジェクトの進捗管理
   - 要件定義フェーズ完了、設計フェーズに移行
   - 週次進捗会議を2回実施（1/16, 1/18）
   - 課題管理表の更新と共有

3. 新規リードへのフォローアップ
   - 展示会で獲得したリード15件に対してフォロー電話
   - うち5件でアポイント獲得、来週訪問予定

■ 進捗状況

- A社案件: 80%完了（提案完了、見積もり作成中）
- B社プロジェクト: 予定通り進行中（設計フェーズ25%）
- 新規開拓: 今月目標10件に対して5件獲得（達成率50%）

■ 課題・懸念事項

特になし。順調に進行中。

■ 次週の予定

- 1/22: A社見積もり提出、価格交渉
- 1/23-24: B社設計レビュー会議
- 1/25: 新規リード5件への訪問（C社、D社、E社、F社、G社）
- 1/26: 週次営業会議、月次レポート作成
```

**期待される判定結果: APPROVED**

このサンプルは以下の基準を満たしています：
- 業務内容: 具体的な作業が詳細に記載 ✓
- 進捗状況: 数値・達成率が明記 ✓
- 課題: 記載あり（特になしと明記）✓
- 次週予定: 具体的な計画が記載 ✓
- 文字数: 300文字以上 ✓

---

### サンプル2: NEEDS_REVISION（要修正）パターン

```
週報 - 佐藤花子
2024年1月15日〜1月19日

■ 今週の業務内容

1. H社のシステム保守対応
   - 問い合わせ対応を実施
   - 障害対応あり

2. 社内ミーティング参加
   - 定例会議に参加

3. ドキュメント作成
   - マニュアル更新作業

■ 進捗状況

順調に進んでいます。

■ 課題・懸念事項

H社の障害対応に時間がかかり、他の業務に影響が出ています。
原因調査に時間を要しており、根本対策の検討が必要です。

■ 次週の予定

- H社対応の継続
- その他業務
```

**期待される判定結果: NEEDS_REVISION**

このサンプルは以下の問題点があります：
- 業務内容: 記載はあるが具体性に欠ける（何時間？何件？）△
- 進捗状況: 「順調」のみで数値がない NG
- 課題: 記載あり ✓
- 次週予定: 「その他業務」など曖昧 △
- 文字数: 300文字以上 ✓（ギリギリ）

必須項目は一応満たしているが、軽微な指摘が2件以上あるため「要修正」判定になります。

---

### サンプル3: RESUBMIT（再提出）パターン

```
週報 - 鈴木一郎

今週も頑張りました。
来週も頑張ります。
```

**期待される判定結果: RESUBMIT**

このサンプルは以下の必須項目を満たしていません：
- 業務内容: 記載なし NG
- 進捗状況: 記載なし NG
- 課題: 記載なし（課題がない場合でも言及が必要）NG
- 次週予定: 「頑張ります」のみで具体的な計画なし NG
- 文字数: 300文字未満（約30文字）NG

ほぼすべての必須項目が欠落しているため「再提出」判定になります。

---

## 条件分岐ロジック

```
IF JUDGMENT == "APPROVED":
    → Chat DM（自分）で承認結果を受信
    → Update status to "承認済" (Sheets)
    → 手動で提出者へ承認通知を転送

ELSE IF JUDGMENT == "NEEDS_REVISION":
    → Chat DM（自分）で修正依頼内容を受信
    → Update status to "要修正" (Sheets)
    → Include specific feedback from CHECKLIST_RESULT
    → 手動で提出者へ修正依頼を転送 (+24h期限)

ELSE IF JUDGMENT == "RESUBMIT":
    → Chat DM（自分）で再提出依頼内容を受信
    → Update status to "再提出" (Sheets)
    → 手動で提出者へ再提出依頼を転送 (+48h期限)
```

---

## 効果測定の指標

| 指標 | Before | After | 改善率 |
|---|---|---|---|
| チェック時間 | 30分/日 | 3分/日 | 90%削減 |
| フィードバック遅延 | 平均24時間 | 即時（数秒） | 99%短縮 |
| 再提出率 | 25% | 8% | 68%改善 |
| 品質スコア平均 | 72点 | 88点 | 22%向上 |

---

## テスト確認ポイント

- [ ] 合格ケース: 全項目記載済みの完璧な提出物 → APPROVED判定 → Chat DM受信後、手動転送
- [ ] 要修正ケース: 数値が曖昧、具体性に欠ける → NEEDS_REVISION判定 → Chat DM受信後、手動転送
- [ ] 再提出ケース: 必須項目が未記載 → RESUBMIT判定 → Chat DM受信後、手動転送
- [ ] フィードバック内容が具体的で改善に役立つ内容か
- [ ] Sheetsのステータスが正しく更新されているか
- [ ] 期限が正しく設定されているか（要修正: +24h、再提出: +48h）

---

## 今日のポイント

- 5つのチェック項目（業務内容・進捗・課題・予定・文字数）で品質を自動判定
- APPROVED / NEEDS_REVISION / RESUBMIT の3段階で条件分岐処理
- 判定結果はChat DMで即時通知（手動で転送してフィードバック）
- RESSUBMITのみ管理者に通知し、管理者の負担を最小化
- 即時フィードバックで品質向上サイクルを確立
- チェック業務時間90%削減、品質スコア22%向上を実現

---

## 注意事項

現在のWorkspace Studioでは外部へのメール・Chat送信は未対応です。フィードバックは自分へのDMで受け取り、内容を確認後、手動で提出者へ転送してください。
