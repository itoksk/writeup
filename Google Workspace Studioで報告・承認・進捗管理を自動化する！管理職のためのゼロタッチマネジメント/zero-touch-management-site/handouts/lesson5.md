# 第5回（最終回）：誰に何をいつ伝えるかを整理し遅延ゼロを実現する！承認プロセスを自動化するワークフロー

## 学習目標

稟議・経費・休暇申請の承認フローを自動化し、申請内容の自動分類、適切な承認者への自動ルーティング、承認待ち監視とリマインド、結果に応じた自動処理を実装。8つのエージェントでゼロタッチマネジメントを完成させます。

---

## BEFORE / AFTER

| Before（受講前） | After（受講後） |
|---|---|
| 承認依頼を手動でルーティング | 承認依頼を自動分類・ルーティング |
| 承認遅延に気づけない | 自動リマインド・エスカレーション |
| リマインドを個別に送信 | 8つのAgentでゼロタッチマネジメント完成 |
| 管理業務に多くの時間を消費 | 管理業務70%削減を実現 |

---

## 作成するエージェント

| No. | エージェント名 | 説明 |
|---|---|---|
| 7 | Approval Request Agent | 申請内容を自動分類し、金額・種類に応じて適切な承認者を決定。承認依頼を自動送信 |
| 8 | Approval Monitor Agent | 承認待ち案件を監視し、設定した期間に応じてリマインド・エスカレーションを自動実行 |

**デモ推奨:** 2つのエージェントのうち「承認監視エージェント」がデモに最適です。理由：
1. **スケジュールトリガー + Sheets読み込み + Gemini判定** - Lesson 4と似た構成だが、承認フローという異なるユースケース
2. **条件分岐（リマインド/エスカレーション）** - 経過時間による分岐判定は新しい学び
3. **シンプルで再現しやすい** - 承認待ちシートを用意すればすぐテスト可能

---

## エージェント作成プロンプト

以下のプロンプトをコピーして、Google Workspace Studio（https://studio.workspace.google.com/）で実行してください。

### エージェント1: 承認依頼エージェント

```
承認依頼エージェントを作成してください。
すべての出力は日本語でお願いします。

【エージェント名】
承認依頼エージェント

【説明】
申請メールを受信したら、内容を自動分類し、適切な承認者を決定して自分にChat DMで通知します

【スターター】
Gmail - 新しいメールを受信したとき
条件: 件名に「申請」「稟議」「経費」「休暇」のいずれかを含む

【処理フロー】
1. 条件分岐:
   - 添付ファイルがある場合 → Googleドライブに保存へ
   - 添付ファイルがない場合 → 直接Geminiへ

2. Googleドライブに保存（添付がある場合）:
   - 保存先フォルダ: 申請書フォルダ/{年}/{月}/
   - ファイル名: {日付}_{送信者名}_{元のファイル名}
   - ※ このステップで{Drive links}変数が生成されます

3. スプレッドシート読み込み（承認者マスタ）:
   - 対象シート: 承認管理シート > 承認者マスタ
   - 操作: すべての行を取得
   - 取得する列: 申請者名, 部署, 直属上長, 直属上長メール, 部門長, 部門長メール

4. Geminiに聞く（申請内容の分類）:
   あなたは承認ワークフローのアシスタントです。
   申請メールの内容を分析し、適切な承認者を決定してください。

   【メール情報】
   件名: {件名}
   送信者: {送信者}
   本文: {本文}

   【添付ファイル（ある場合）】
   {Drive links}を開いて、申請書の内容（金額、申請内容など）を確認してください。
   ※添付ファイルがない場合はメール本文のみで判定

   【承認者マスタ】
   申請者名: {申請者名}
   部署: {部署}
   直属上長: {直属上長}
   部門長: {部門長}

   【やること】
   1. 申請の種類を判定してください（経費申請/稟議/休暇申請/その他）
   2. 金額がある場合は金額を抽出してください
   3. 緊急度を判定してください（通常/急ぎ/緊急）
   4. 以下のルールで承認者を決定してください:
      - 経費申請で5万円未満 → 直属上長
      - 経費申請で5万円以上 → 部門長
      - 稟議で50万円未満 → 部門長
      - 稟議で50万円以上 → 部門長 → 経営層（2段階承認）
      - 休暇申請 → 直属上長

   【出力形式例】（必ず日本語で出力してください）
   ■ 申請種類
   経費申請 / 稟議 / 休暇申請 / その他

   ■ 申請者
   氏名（部署）

   ■ 金額
   ○○円（または「該当なし」）

   ■ 緊急度
   通常 / 急ぎ / 緊急

   ■ 申請内容の要約
   （2-3行で要約）

   ■ 承認者
   第1承認者: 氏名（役職）
   第2承認者: 氏名（役職）または「なし」

   ■ リマインド期限
   ○○時間後

   ■ エスカレーション期限
   ○○時間後

5. スプレッドシート書き込み（承認管理シートに記録）:
   - 対象シート: 承認管理シート > 承認待ちリスト
   - 操作: 行を追加
   - 追加データ: 申請日時, 申請者, 種類, 金額, 承認者, ステータス（承認待ち）, リマインド期限

6. Chat DM送信（自分宛て）:
   【承認依頼が届きました】

   以下の申請を受け付けました。
   承認者へ手動で転送してください。

   {Geminiの出力結果}

   --- 承認者への転送用メッセージ ---
   件名：【承認依頼】{申請種類} - {申請者名}
   （転送用のテンプレートをここに記載）
   --- 転送用メッセージここまで ---

【出力先】
- 自分へのChat DM
- スプレッドシート（承認管理シート）
- Googleドライブ（添付ファイル保存）

【事前準備が必要なもの】
1. 「承認管理シート」という名前のスプレッドシートを作成
2. その中に「承認者マスタ」シートを作成
   - A列: 申請者名
   - B列: 部署
   - C列: 直属上長
   - D列: 直属上長メール
   - E列: 部門長
   - F列: 部門長メール
3. その中に「承認待ちリスト」シートを作成
   - A列: 申請日時
   - B列: 申請者
   - C列: 種類
   - D列: 金額
   - E列: 承認者
   - F列: ステータス
   - G列: リマインド期限
   - H列: エスカレーション期限

このエージェントを日本語で作成してください。
```

---

### エージェント2: 承認監視エージェント（デモ推奨）

```
承認監視エージェントを作成してください。
すべての出力は日本語でお願いします。

【エージェント名】
承認監視エージェント

【説明】
毎日10時と15時に承認待ち案件をチェックし、リマインドやエスカレーションが必要な案件を自分にChat DMで通知します

【スターター】
スケジュール - 毎日10:00、15:00

【処理フロー】
1. スプレッドシート読み込み（承認待ちリスト）:
   - 対象シート: 承認管理シート > 承認待ちリスト
   - 操作: すべての行を取得
   - 取得する列: 申請日時, 申請者, 種類, 金額, 承認者, ステータス, リマインド期限, エスカレーション期限

2. Geminiに聞く（経過時間と対応判定）:
   あなたは承認待ち案件を監視するアシスタントです。
   承認待ちリストを確認し、リマインドやエスカレーションが必要な案件を特定してください。

   【やること】
   1. まず現在の日時を確認してください
   2. 承認待ちリストから、ステータスが「承認待ち」の案件だけを抽出してください
   3. 各案件について、申請日時からの経過時間を計算してください
   4. 以下のルールでリマインド・エスカレーション対象を判定:
      - リマインド期限を超過 → リマインド対象
      - エスカレーション期限を超過 → エスカレーション対象

   【承認待ちリスト】
   申請日時: {申請日時}
   申請者: {申請者}
   種類: {種類}
   金額: {金額}
   承認者: {承認者}
   ステータス: {ステータス}
   リマインド期限: {リマインド期限}
   エスカレーション期限: {エスカレーション期限}

   【出力形式例】（必ず日本語で出力してください）
   ■ 現在日時
   （現在の日時）

   ■ リマインド対象（○件）
   ・申請種類 - 申請者名 → 承認者名（経過○時間）
   ※該当なしの場合は「なし」と記載

   ■ エスカレーション対象（○件）
   ・申請種類 - 申請者名 → 承認者名（経過○時間）→ エスカレーション先
   ※該当なしの場合は「なし」と記載

   ■ 承認待ち案件サマリー
   ・承認待ち総数: ○件
   ・リマインド対象: ○件
   ・エスカレーション対象: ○件

   ■ 対応が必要か
   「対応必要」または「対応不要（すべて期限内）」

3. 条件分岐:
   - 判定結果が「対応必要」の場合 → Chat DM通知へ
   - 判定結果が「対応不要」の場合 → 終了

4. Chat DM送信（自分宛て）:
   【承認監視アラート】

   承認待ち案件の状況をお知らせします。

   {Geminiの出力結果}

   --- リマインド用メッセージ（参考）---
   件名：【リマインド】承認待ち案件があります
   ○○さん、以下の承認依頼が○時間以上未処理です。
   ご確認・ご対応をお願いいたします。
   --- リマインドここまで ---

   --- エスカレーション用メッセージ（参考）---
   件名：【エスカレーション】承認遅延案件のご確認
   ○○さん、以下の承認依頼が長時間未処理です。
   フォローをお願いいたします。
   --- エスカレーションここまで ---

【出力先】
- 自分へのChat DM

【事前準備が必要なもの】
「承認管理シート」の「承認待ちリスト」シートにテスト用データを登録:
- 申請日時を2日前に設定 → リマインド対象になる
- 申請日時を3日前に設定 → エスカレーション対象になる

このエージェントを日本語で作成してください。
```

---

## 承認ルールマトリクス

| 申請種類 | 金額条件 | 第1承認者 | 第2承認者 | リマインド | エスカレーション |
|---|---|---|---|---|---|
| 経費申請 | < 50,000円 | 直属上長 | - | 48h後 | 72h後 |
| 経費申請 | >= 50,000円 | 部門長 | - | 48h後 | 72h後 |
| 稟議 | < 500,000円 | 部門長 | - | 48h後 | 72h後 |
| 稟議 | >= 500,000円 | 部門長 | 経営層 | 24h後 | 48h後 |
| 休暇申請 | - | 直属上長 | - | 24h後 | 48h後 |

**ポイント:** 金額が大きいほど上位承認者が必要となり、緊急度に応じてリマインド・エスカレーションの間隔が短くなります。

---

## 承認フロー全体像

```
申請受付 (Gmail/Forms)
    ↓
申請内容の自動分類 (Gemini)
    ↓
承認者の自動決定 (ルールベース)
    ↓
承認依頼の通知（自分へ Chat DM → 手動で承認者へ転送）
    ↓
承認待ち監視 (Schedule)
    ↓
┌─────────────┬─────────────┬─────────────┐
│  承認       │  差し戻し    │  却下       │
│→ 完了通知   │→ 修正依頼   │→ 却下通知   │
│→ 次の承認者 │→ 再申請待ち │→ 案件クローズ│
└─────────────┴─────────────┴─────────────┘
```

---

## エージェント設計

### Agent 7: Approval Request Agent

| 項目 | 設定値 |
|---|---|
| エージェント名 | Approval Request Agent |
| 説明 | 申請を処理し、添付ファイルを読み取って適切な承認者にルーティング |
| スターター | Gmail（件名に「申請」「稟議」を含む）またはForms |
| 処理ステップ | 条件分岐（添付有無）→ Drive（ファイル保存）→ Gemini（申請分類 + 「開いて」でファイル読み取り）→ 条件分岐（承認者決定） |
| 出力（自分へ） | Chat DM: 承認依頼内容を自分に通知 → 手動で承認者へ転送 |
| 出力（Sheets） | Sheets: 承認管理シートに記録 |

**添付ファイルの読み取り:** 稟議書PDFや見積書Excelが添付されている場合、まずDriveステップで保存し、Geminiステップで「{Drive links}を開いて金額を確認」のようにプロンプトを設定すると、ファイルの中身を分析できます。

### Agent 8: Approval Monitor Agent

| 項目 | 設定値 |
|---|---|
| エージェント名 | Approval Monitor Agent |
| 説明 | 承認待ち案件を監視し、リマインド・エスカレーションを自動実行 |
| スターター | Scheduled（毎日 10:00 および 15:00 JST） |
| データソース | Sheets: 承認待ちリスト読み込み |
| 処理ステップ | Gemini（経過時間・緊急度判定）→ 条件分岐 |
| 出力（リマインド） | Chat DM: リマインド対象を自分に通知 → 手動で承認者へ連絡 |
| 出力（エスカレーション） | Chat DM: エスカレーション対象を自分に通知 → 手動で上位者へ連絡 |

---

## 申請分類・承認者決定プロンプト

```
あなたは承認ワークフローのアシスタントです。
申請メールの内容を分析し、適切な承認者を決定してください。

【メール本文】
---
{本文}
---

【添付ファイル（ある場合）】
{Drive links}を開いて、内容を確認してください。

※「開いて」キーワードと{Drive links}変数で添付ファイル（稟議書PDF、見積書Excel等）の中身を読み取り、金額や詳細を抽出します。

【承認者マスタ】
申請者名: {申請者名}
部署: {部署}
直属上長: {直属上長}
部門長: {部門長}

【やること】
1. 申請の種類を判定: 経費申請 / 稟議 / 休暇申請 / その他
2. 金額を抽出（メール本文または添付ファイルから）
3. 緊急度を判定: 通常 / 急ぎ / 緊急
4. 以下のルールで承認者を決定:
   - 経費 < 5万円: 直属上長
   - 経費 >= 5万円: 部門長
   - 稟議 < 50万円: 部門長
   - 稟議 >= 50万円: 部門長 → 経営層（2段階承認）
   - 休暇: 直属上長

【出力形式例】（必ず日本語で出力してください）
---
■ 申請種類: 経費申請 / 稟議 / 休暇申請 / その他
■ 金額: ○○円（または「該当なし」）
■ 申請者: 氏名（部署）
■ 要約: （1行で内容を要約）
■ 緊急度: 通常 / 急ぎ / 緊急
■ 第1承認者: 氏名
■ 第2承認者: 氏名（または「なし」）
■ リマインド期限: ○○時間後
■ エスカレーション期限: ○○時間後
■ 添付ファイルの要約: （あれば記載）
---
```

---

## 承認待ち監視プロンプト

```
あなたは承認待ち案件を監視するアシスタントです。
承認待ちリストを確認し、リマインドやエスカレーションが必要な案件を特定してください。

【やること】
1. まず現在の日時を確認してください
2. 承認待ちリストから、ステータスが「承認待ち」の案件を抽出してください
3. 各案件について、申請日時からの経過時間を計算してください
4. 以下のルールで対応を判定:
   - リマインド期限を超過 → リマインド対象
   - エスカレーション期限を超過 → エスカレーション対象

【承認待ちリスト】
申請日時: {申請日時}
申請者: {申請者}
種類: {種類}
金額: {金額}
承認者: {承認者}
ステータス: {ステータス}
リマインド期限: {リマインド期限}
エスカレーション期限: {エスカレーション期限}

【出力形式例】（必ず日本語で出力してください）
---
■ 現在日時
（現在の日時）

■ リマインド対象（○件）
・申請種類 - 申請者名 → 承認者名（経過○時間）
※該当なしの場合は「なし」と記載

■ エスカレーション対象（○件）
・申請種類 - 申請者名 → 承認者名（経過○時間）
※該当なしの場合は「なし」と記載

■ サマリー
・承認待ち総数: ○件
・リマインド対象: ○件
・エスカレーション対象: ○件

■ 対応が必要か
「対応必要」または「対応不要」
---
```

---

## 承認依頼通知テンプレート（自分宛Chat DM）

```
**承認依頼が届きました**

■ 申請内容
・種類: {request_type}
・申請者: {requester}
・部署: {department}
・金額: {amount}円
・緊急度: {urgency}
・承認者: {approver}

■ 概要
{summary}

■ 詳細
{request_detail}

■ 対応期限
{deadline}（{reminder_hours}時間後にリマインド）

--- 以下、承認者へ転送するメッセージ ---

件名：【承認依頼】{request_type} - {requester}

{approver}さん

お疲れ様です。
以下の申請について、承認をお願いいたします。

■ 申請内容
・種類: {request_type}
・申請者: {requester}
・部署: {department}
・金額: {amount}円
・緊急度: {urgency}

■ 概要
{summary}

■ 対応期限
{deadline}

■ 承認・差し戻し・却下
メール返信またはフォームにてご連絡ください。

よろしくお願いいたします。

--- 転送用メッセージここまで ---
```

**運用:** 外部送信は未対応のため、Chat DMで受信後、手動で承認者へメール転送してください。

---

## リマインド・エスカレーション通知テンプレート

```
**リマインド対象案件**
---
以下の承認依頼が{hours}時間以上未処理です。
承認者へ直接連絡してください。

■ 承認待ち案件
{pending_items_list}

■ 承認者: {approver}

--- 承認者への連絡文（参考）---
件名：【リマインド】承認待ち案件があります
{approver}さん、以下の承認依頼が{hours}時間以上未処理となっています。
お手数ですが、ご確認・ご対応をお願いいたします。
---

**エスカレーション対象案件**
---
以下の承認依頼が{escalation_hours}時間以上未処理です。
上位者へ連絡してください。

■ 遅延案件
・申請: {request_summary}
・申請者: {requester}
・承認者: {approver}
・経過時間: {hours}時間
・緊急度: {urgency}

■ エスカレーション先: {manager}

--- 上位者への連絡文（参考）---
件名：【エスカレーション】承認遅延案件のご確認
{manager}さん、以下の承認依頼が{escalation_hours}時間以上未処理です。
フォローをお願いいたします。
---
```

---

## 作成ステップ

1. **承認管理シートの準備**: 承認管理シート（申請ID、申請者、種類、金額、ステータス、承認者、申請日時、承認日時、コメント）を作成

2. **承認者マスタの準備**: メンバーマスタシートに直属上長、部門長、経営層の情報を追加。承認ルーティングに使用

3. **Approval Request Agent 作成**: Gmailスターター/Formsスターター → Geminiステップで分類 → 条件分岐で承認者決定 → Chat DMステップで自分に通知 → Sheetsステップで記録

4. **Approval Monitor Agent 作成**: スケジュールスターター（10:00/15:00）→ Sheetsステップで承認待ちチェック → Geminiステップで判定 → Chat DMステップで自分に通知

5. **承認応答処理の設定**: 承認/差し戻し/却下のリンクをForms/メール返信で受け付け、結果に応じた処理を実行

6. **テスト・調整**: 各パターン（承認/差し戻し/却下、単段階/多段階、リマインド/エスカレーション）をテスト

---

## Tips: Geminiで添付ファイル（稟議書・見積書など）の内容を読み取る方法

Gmailで受信した稟議書PDF・見積書Excelなどの添付ファイルをGeminiに分析させたい場合:

1. **Step 1:** まずDriveステップでファイルを保存 → `{Drive links}` 変数が生成される
2. **Step 2:** Geminiステップで「**開いて**」キーワードと共に {Drive links} 変数を使用
3. **例:** 「{Drive links}を**開いて**、金額・申請内容・承認者を抽出してください」

※ 添付ファイルを直接Geminiに渡すことはできません。必ずDriveに保存してからDrive links経由で読み取ります。

---

## テスト確認ポイント

- [ ] 申請種類と金額が正しく分類されているか
- [ ] 適切な承認者に依頼が送信されているか
- [ ] 多段階承認（稟議50万以上）が正しく動作するか
- [ ] リマインドが設定した時間後に送信されているか
- [ ] エスカレーションが正しい上位者に送信されているか
- [ ] 承認・差し戻し・却下の各結果処理が正しく動作するか

---

## コースで作成したエージェント一覧

| No. | エージェント名 | 説明 |
|---|---|---|
| 1 | Daily Report Request | スケジュールスターター 17:00 → 提出依頼送信 |
| 2 | Report Summary | Gmailスターター → Geminiステップで要約・Chat DM通知 |
| 3 | Quality Check | Gmailスターター → Geminiステップで品質判定・フィードバック |
| 4 | Submission Check | スケジュールスターター 20:00 → 未提出検知・アラート |
| 5 | Dashboard Update | スケジュールスターター 21:00 → ダッシュボード更新 |
| 6 | Weekly Summary | スケジュールスターター 金曜18:00 → 週次サマリー |
| 7 | Approval Request | Gmail/Formsスターター → 承認依頼・ルーティング |
| 8 | Approval Monitor | スケジュールスターター 10:00/15:00 → 承認監視 |

---

## コース全体の成果

| 指標 | 成果 |
|---|---|
| 管理業務削減 | 70% |
| 連絡漏れ | 0件 |
| 進捗把握 | 即時 |

### Before / After 比較

| Before | After |
|---|---|
| 提出依頼を毎日手動送信 | 提出依頼は17:00に自動送信 |
| 日報確認に60分/日かかる | 日報確認は要約で12分/日（80%削減） |
| 品質チェックは目視で手動 | 品質チェックはAIが自動判定 |
| 未提出者の把握に時間がかかる | 未提出者は20:00に自動アラート |
| 承認依頼を手動でルーティング | 承認依頼は自動分類・ルーティング |
| 承認遅延に気づけない | 承認遅延は自動リマインド・エスカレーション |

---

## 今日のポイント

- Gmail/Formsスターターで申請を受け付け、Geminiステップで自動分類・承認者決定
- 条件分岐ステップで適切な承認者を判定、Chat DMで自分に通知（手動で承認者へ転送）
- スケジュールスターター（10:00/15:00）で承認待ちを監視、Chat DMでリマインド・エスカレーション対象を通知
- 承認・差し戻し・却下の結果に応じた自動処理で申請者に即時通知
- 8つのエージェントで「ゼロタッチマネジメント」を完全実現
- 管理業務70%削減、連絡漏れゼロ、即時進捗把握を達成

---

## 注意事項

現在のWorkspace Studioでは外部へのメール送信・スペースへの投稿は未対応です。承認依頼・リマインド・エスカレーションは自分へのChat DMで受信し、手動で転送してください。

---

## コース完了おめでとうございます！

ゼロタッチマネジメントの構築が完了しました。自社の業務に合わせてカスタマイズし、管理業務の自動化を実現してください。
